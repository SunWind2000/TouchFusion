const R=i=>typeof i=="string",Y=i=>typeof i=="function",X=i=>i===null||Object.prototype.toString.call(i)==="[object Array]"?!1:typeof i=="object",d=i=>Array.isArray(i),q=i=>`${i}-${Date.now()}-${Math.floor(Math.random()*1e5)}`,T=(i,t,e)=>{if(!(!X(i)&&!d(i)))if(d(i))i.forEach(t,e);else for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&t.call(e,i[s],s,i)},v=(i,t,e)=>!d(i)||!Y(e[t])?!1:(T(i,e[t],e),!0),B=(i,t,e=!1)=>{const s=[],n=[];for(let r=0;r<i.length;r++){const h=t?i[r][t]:i[r];n.indexOf(h)===-1&&s.push(i[r]),n[r]=h}return e&&(t?s.sort((r,h)=>r[t]>h[t]?1:-1):s.sort()),s},x=(i,t,e)=>{T(t,s=>{R(s)&&i.addEventListener(s,e,!1)})},P=(i,t,e)=>{T(t,s=>{R(s)&&i.removeEventListener(s,e,!1)})},w=(i,t)=>{for(;i;){if(i===t)return!0;i=i.parentNode}return!1},N=(i,t)=>function(...e){return i.apply(t,e)};class E{constructor(t,e){this._evEl=[],this._evWin=[],this._evTarget=[],this._manager=t,this.el=t.element,this._target=t.options.inputTarget,this.callback=e,this.domHandler=s=>{this._manager.options.enable&&this.handler(s)}}get manager(){return this._manager}get target(){return this._target}set evEl(t){this._evEl=t}set evWin(t){this._evWin=t}set evTarget(t){this._evTarget=t}init(){this._evEl.length!==0&&x(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&x(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&x(window,this._evWin,this.domHandler)}destroy(){this._evEl.length!==0&&P(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&P(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&P(window,this._evWin,this.domHandler)}}var g=(i=>(i[i.None=1]="None",i[i.Left=2]="Left",i[i.Right=4]="Right",i[i.Up=8]="Up",i[i.Down=16]="Down",i[i.Horizontal=6]="Horizontal",i[i.Vertical=24]="Vertical",i[i.All=30]="All",i))(g||{}),o=(i=>(i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel",i))(o||{}),_=(i=>(i.Touch="touch",i.Mouse="mouse",i.Pen="pen",i.Kinect="kinect",i))(_||{});const H=25,O=/mobile|tablet|ip(ad|hone|od)|android/i,I="ontouchstart"in window||navigator.maxTouchPoints>0,V="PointerEvent"in window,k=I&&O.test(navigator.userAgent),j={mousedown:o.Start,mousemove:o.Move,mouseup:o.End},L=["mousedown"],U=["mousemove","mouseup"];class F extends E{constructor(t,e){super(t,e),this.evEl=L,this.evWin=U,this._pressed=!1,this.init()}handler(t){const e=j[t.type];e===o.Start&&t.button===0&&(this._pressed=!0),this._pressed&&(e===o.End&&(this._pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:_.Mouse,srcEvent:t}))}}const $={touchstart:o.Start,touchmove:o.Move,touchend:o.End,touchcancel:o.Cancel},G=["touchstart","touchmove","touchend","touchcancel"];class D extends E{constructor(t,e){super(t,e),this.evTarget=G,this.targetIds={},this.init()}handler(t){const e=$[t.type],s=this.getTouches(t,e);s&&this.callback(this.manager,e,{pointers:s[0],changedPointers:s[1],pointerType:_.Touch,srcEvent:t})}getTouches(t,e){const s=Array.from(t.touches);if(e&(o.Start|o.Move)&&s.length===1){const l=s[0];return this.targetIds[l.identifier]=!0,[s,s]}const n=s.filter(l=>w(l.target,this.target));if(e===o.Start)for(let l=0;l<n.length;l++)this.targetIds[n[l].identifier]=!0;const r=Array.from(t.changedTouches),h=[];for(let l=0;l<n.length;l++)this.targetIds[n[l].identifier]&&h.push(r[l]),(e===o.End||e===o.Cancel)&&delete this.targetIds[r[l].identifier];return h.length?[B(n.concat(h),"identifier",!0),h]:null}}const Z={pointerdown:o.Start,pointermove:o.Move,pointerup:o.End,pointercancel:o.Cancel,pointerout:o.Cancel},K=["pointerdown"],Q=["pointermove","pointerup","pointercancel","pointerout"];class J extends E{constructor(t,e){super(t,e),this.evEl=K,this.evWin=Q,this._store=[],this.init()}handler(t){const e=Z[t.type],s=t.pointerType===_.Touch;let n=this._store.findIndex(h=>h.pointerId===t.pointerId),r=!1;e===o.Start&&(t.button===0||s)?n===-1&&(this._store.push(t),n=this._store.length-1):(e===o.End||e===o.Cancel)&&(r=!0),n!==-1&&(this._store[n]=t,this.callback(this.manager,e,{pointers:this._store,changedPointers:[t],pointerType:t.pointerType,srcEvent:t}),r&&this._store.splice(n,1))}}const tt=2500,b=25;class et extends E{constructor(t,e){super(t,e);const s=N(this.handler,this);this._mouse=new F(t,s),this._touch=new D(t,s),this._primaryTouch=null,this._lastTouches=[]}handler(t,e,s){const n=s.pointerType===_.Touch,r=s.pointerType===_.Mouse;if(n)this._recordTouches(e,s);else if(r&&this._isSyntheticEvent(s))return}destroy(){this._mouse.destroy(),this._touch.destroy()}_recordTouches(t,e){t===o.Start?(this._primaryTouch=e.changedPointers[0].identifier,this._setLastTouch(e)):(t===o.End||t===o.Cancel)&&this._setLastTouch(e)}_setLastTouch(t){const e=t.changedPointers[0];if(e.identifier===this._primaryTouch){const s={x:e.clientX,y:e.clientY};this._lastTouches.push(s);const n=setTimeout(()=>{const r=this._lastTouches.indexOf(s);r>-1&&this._lastTouches.splice(r,1),clearTimeout(n)},tt)}}_isSyntheticEvent(t){const e=t.srcEvent,s=e.clientX,n=e.clientY;for(let r=0;r<this._lastTouches.length;r++){const h=this._lastTouches[r],l=Math.abs(s-h.x),p=Math.abs(n-h.y);if(l<=b&&p<=b)return!0}return!1}}class u{static getAngle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*180/Math.PI}static getDistance(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)}static getDirection(t,e){return t===e?g.None:Math.abs(t)>=Math.abs(e)?t<0?g.Left:g.Right:e<0?g.Up:g.Down}static getCenter(t){const e=Math.round(t.reduce((n,r)=>n+r.x,0)/t.length),s=Math.round(t.reduce((n,r)=>n+r.y,0)/t.length);return{x:e,y:s}}static getRotation(t,e){return this.getAngle(e[1],e[0])+this.getAngle(t[1],t[0])}static getScale(t,e){return this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1])}static getVelocity(t,e,s){return{x:e/t||0,y:s/t||0}}}const it=(i,t,e)=>{const s=e.pointers.length,n=e.changedPointers.length,r=t&o.Start&&s-n===0,h=t&(o.End|o.Cancel)&&s-n===0;e.isFirst=!!r,e.isFinal=!!h,r&&i.clearSession(),e.eventType=t,st(i,e),i.options.preventDefault&&e.srcEvent.preventDefault(),i.options.stopPropagation&&e.srcEvent.stopPropagation(),i.options.stopImmediatePropagation&&e.srcEvent.stopImmediatePropagation(),i.emit(y.Secret,e),i.recognize(e),i.session.prevInput=e},st=(i,t)=>{var e;const s=i.session,n=t.pointers.length;s.firstInput||(s.firstInput=S(t)),n>1&&!s.firstMultiple?s.firstMultiple=S(t):n===1&&(s.firstMultiple=null);const{firstInput:r,firstMultiple:h}=s,l=h?h.center:r.center,p=[];(e=t.pointers)==null||e.forEach(C=>{p.push({x:Math.round(C.clientX),y:Math.round(C.clientY)})});const m=t.center=u.getCenter(p);t.timestamp=Date.now(),t.deltaTime=t.timestamp-r.timestamp,t.angle=u.getAngle(l,m),t.distance=u.getDistance(l,m),nt(s,t),t.offsetDirection=u.getDirection(t.deltaX,t.deltaY);const c=u.getVelocity(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=Math.abs(c.x)>Math.abs(c.y)?c.x:c.y,t.scale=h?u.getScale(h.pointers,p):1,t.rotation=h?u.getRotation(h.pointers,p):0,t.maxPointers=s.prevInput?Math.max(t.pointers.length,s.prevInput.maxPointers):t.pointers.length;const M=i.element;w(t.srcEvent.target,M)?t.target=t.srcEvent.target:t.target=M,rt(s,t)},S=i=>{const t=[];for(let e=0;e<i.pointers.length;e++)t.push({x:Math.round(i.pointers[e].clientX),y:Math.round(i.pointers[e].clientY)});return{pointers:t,timestamp:Date.now(),center:u.getCenter(t),deltaX:i.deltaX||0,deltaY:i.deltaY||0}},nt=(i,t)=>{const e=t.center;let s=i.offsetDelta||{x:0,y:0},n=i.prevDelta||{x:0,y:0};const r=i.prevInput||{center:e};(t.eventType===o.Start||t.eventType===o.End)&&(n=i.prevDelta={x:r.deltaX||0,y:r.deltaY||0},s=i.offsetDelta={x:e.x,y:e.y}),t.deltaX=n.x+(e.x-s.x),t.deltaY=n.y+(e.y-s.y)},rt=(i,t)=>{const e=i.lastInterval||t,s=t.timestamp-e.timestamp;let n,r,h,l;if(t.eventType!==o.Cancel&&(s>H||e.velocity===void 0)){const p=t.deltaX-e.deltaX,m=t.deltaY-e.deltaY,c=u.getVelocity(s,p,m);r=c.x,h=c.y,n=Math.abs(c.x)>Math.abs(c.y)?c.x:c.y,l=u.getDirection(p,m),i.lastInterval=t}else r=e.velocityX,h=e.velocityY,n=e.overallVelocity,l=e.direction;t.velocityX=r,t.velocityY=h,t.velocity=n,t.direction=l},ot=i=>{let t;return V?t=J:k?t=D:I?t=et:t=F,new t(i,it)};var a=(i=>(i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Canceled=16]="Canceled",i[i.Failed=32]="Failed",i))(a||{}),y=(i=>(i.Secret="touch-fusion.input",i.Unknown="unknown",i.Swipe="swipe",i.Pan="pan",i.Pinch="pinch",i.Rotate="rotate",i.Press="press",i.Tap="tap",i))(y||{});class z{constructor(t){this._type=y.Unknown,this._options={...t},this._id=q(this.type),this._manager=null,this._options.enable=this._options.enable??!0,this._state=a.Possible,this.simultaneous={},this.requireFails=[]}get type(){return this._type}get id(){return this._id}get state(){return this._state}get options(){return this._options}get hasRequireFailures(){return this.requireFails.length>0}set state(t){this._state=t}set manager(t){this._manager=t}set(t){this._options={...this._options,...t}}canRecognizeWith(t){return!!this.simultaneous[t.id]}recognizeWith(t){if(d(t)&&v(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.simultaneous[e.id]&&(this.simultaneous[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(d(t)&&v(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&delete this.simultaneous[e.id],this}requireFailure(t){if(d(t)&&v(t,"requireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.requireFails.includes(e)&&(this.requireFails.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(d(t)&&v(t,"dropRequireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);if(e){const s=this.requireFails.indexOf(e);s>-1&&this.requireFails.splice(s,1)}return this}emit(t){(e=>{var s;(s=this._manager)==null||s.emit(e,t)})(this._type)}tryEmit(t){this.canEmit()&&this.emit(t),this._state=a.Failed}canEmit(){for(const t of this.requireFails)if(t._state!==a.Ended&&t._state!==a.Possible)return!1;return!0}recognize(t){const e={...t};this._options.enable||(this.reset(),this._state=a.Failed),this._state&(a.Ended|a.Canceled|a.Failed)&&(this._state=a.Possible),this._state=this.process(e),this._state&(a.Began|a.Changed|a.Ended|a.Canceled)&&this.tryEmit(e)}getRecognizerByNameIfManager(t,e){return e.manager?e.manager.get(t.type):t}}class at extends z{constructor(t){super(t)}attrTest(t){var e;const{pointers:s}=this.options;return s===0||((e=t.pointers)==null?void 0:e.length)===s}reset(){this.state=a.Possible}process(t){const{eventType:e}=t,s=this.state&(a.Began|a.Changed),n=this.attrTest(t);return s&&(e&o.Cancel||!n)?a.Canceled:s||n?e&o.End?a.Ended:this.state&a.Began?a.Changed:a.Began:a.Failed}}const A=class W extends z{constructor(t={}){super({...W.defaults,...t}),this._timer=null,this._isRecognized=!1,this._type=y.Press}getTouchAction(){return["auto"]}process(t){const e=t.pointers.length===this.options.pointers,s=t.distance<this.options.threshold,n=t.deltaTime>this.options.time;if(!s||!e||t.eventType&(o.End|o.Cancel)&&!n)this.reset();else if(t.eventType&o.Start)this.reset(),this._timer=setTimeout(()=>{this.state=a.Ended,this._isRecognized=!0,this.tryEmit(t)},this.options.time);else if(t.eventType&o.End)return a.Ended;return a.Failed}reset(){this._timer&&clearTimeout(this._timer),this._timer=null}emit(t){this._isRecognized&&(this._isRecognized=!1,t.deltaTime=Date.now()-t.timestamp,t.timestamp=Date.now(),super.emit(t))}};A.defaults={threshold:9,pointers:1,time:251};let ht=A;const ct=Object.freeze(Object.defineProperty({__proto__:null,AttrRecognizer:at,PressRecognizer:ht,RECOGNIZER_STATE:a,RECOGNIZER_TYPE:y,Recognizer:z},Symbol.toStringTag,{value:"Module"}));var f=(i=>(i[i.Stop=1]="Stop",i[i.ForceStop=2]="ForceStop",i))(f||{});const lt={domEvents:!1,touchActions:["compute"],enable:!0,preventDefault:!1,stopPropagation:!1,stopImmediatePropagation:!1,inputTarget:null,cssProps:{userSelect:"none",touchAction:"none"}};class ut{constructor(t,e){this._element=t,this._options={...lt,...e},this._options.inputTarget=(e==null?void 0:e.inputTarget)??this._element,this._recognizers=[],this._input=ot(this),this._session={},this.handlers={},this._oldCssProps={},this._toggleCssProps("add")}get element(){return this._element}get options(){return this._options}get recognizers(){return this._recognizers}get session(){return this._session}stop(t){this._session.stopped=t?f.ForceStop:f.Stop}set(t){this._options={...this._options,...t}}get(t){return this._recognizers.find(e=>e.type===t)||null}add(t){t.manager=this,this._recognizers.push(t)}remove(t){const e=this._recognizers.findIndex(s=>s.type===t.type);e>-1&&this._recognizers.splice(e,1)}on(t,e){this.handlers[t]=e}off(t){t.forEach(e=>{delete this.handlers[e]})}destroy(){this._toggleCssProps("remove"),this._recognizers=[],this._input.destroy(),this._session={},this.handlers={}}recognize(t){if(this._session.stopped)return;let{curRecognizer:e}=this._session;(!e||e&&e.state===a.Ended)&&(e=this._session.curRecognizer=null);for(let s=0;s<this._recognizers.length;s++){const n=this._recognizers[s];this._session.stopped!==f.ForceStop&&(!e||n===e||n.canRecognizeWith(e))?n.recognize(t):n.reset(),!e&&n.state&(a.Began|a.Changed|a.Ended)&&(e=this._session.curRecognizer=n)}}emit(t,e){const s=this.handlers[t];e.type=t,e.preventDefault=()=>{var n;(n=e.srcEvent)==null||n.preventDefault()},s&&s(e)}clearSession(){this._session={}}_toggleCssProps(t){!this._options.cssProps||!this._element.style||(T(this._options.cssProps,(e,s)=>{t==="add"?(this._oldCssProps[s]=this._element.style[s],this._element.style[s]=e):this._element.style[s]=this._oldCssProps[s]||""}),t!=="add"&&(this._oldCssProps={}))}}export{ut as g,ct as u};
