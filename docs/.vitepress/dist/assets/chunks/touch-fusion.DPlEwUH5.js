const k=i=>typeof i=="boolean",C=i=>typeof i=="string",$=i=>typeof i=="function",G=i=>i===null||Object.prototype.toString.call(i)==="[object Array]"?!1:typeof i=="object",_=i=>Array.isArray(i),Z=i=>`${i}-${Date.now()}-${Math.floor(Math.random()*1e5)}`,E=(i,t,e)=>{if(!(!G(i)&&!_(i)))if(_(i))i.forEach(t,e);else for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.call(e,i[n],n,i)},f=(i,t,e)=>!_(i)||!$(e[t])?!1:(E(i,e[t],e),!0),K=(i,t,e=!1)=>{const n=[],s=[];for(let r=0;r<i.length;r++){const h=t?i[r][t]:i[r];s.indexOf(h)===-1&&n.push(i[r]),s[r]=h}return e&&(t?n.sort((r,h)=>r[t]>h[t]?1:-1):n.sort()),n},P=(i,t,e)=>{E(t,n=>{C(n)&&i.addEventListener(n,e,!1)})},x=(i,t,e)=>{E(t,n=>{C(n)&&i.removeEventListener(n,e,!1)})},A=(i,t)=>{for(;i;){if(i===t)return!0;i=i.parentNode}return!1},J=(i,t)=>function(...e){return i.apply(t,e)};class v{constructor(t,e){this._evEl=[],this._evWin=[],this._evTarget=[],this._manager=t,this.el=t.element,this._target=t.options.inputTarget,this.callback=e,this.domHandler=n=>{this._manager.options.enable&&this.handler(n)}}get manager(){return this._manager}get target(){return this._target}set evEl(t){this._evEl=t}set evWin(t){this._evWin=t}set evTarget(t){this._evTarget=t}set target(t){this._target=t}init(){this._evEl.length!==0&&P(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&P(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&P(window,this._evWin,this.domHandler)}destroy(){this._evEl.length!==0&&x(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&x(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&x(window,this._evWin,this.domHandler)}}var l=(i=>(i[i.None=1]="None",i[i.Left=2]="Left",i[i.Right=4]="Right",i[i.Up=8]="Up",i[i.Down=16]="Down",i[i.Horizontal=6]="Horizontal",i[i.Vertical=24]="Vertical",i[i.All=30]="All",i))(l||{});const D=6,w=24;var o=(i=>(i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel",i))(o||{}),m=(i=>(i.Touch="touch",i.Mouse="mouse",i.Pen="pen",i.Kinect="kinect",i))(m||{});const F=25,O=/mobile|tablet|ip(ad|hone|od)|android/i,I="ontouchstart"in window||navigator.maxTouchPoints>0,N="PointerEvent"in window,Y=I&&O.test(navigator.userAgent),Q={mousedown:o.Start,mousemove:o.Move,mouseup:o.End},tt=["mousedown"],et=["mousemove","mouseup"];class X extends v{constructor(t,e){super(t,e),this.evEl=tt,this.evWin=et,this._pressed=!1,this.init()}handler(t){const e=Q[t.type];e===o.Start&&t.button===0&&(this._pressed=!0),this._pressed&&(e===o.End&&(this._pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:m.Mouse,srcEvent:t}))}}const it={touchstart:o.Start,touchmove:o.Move,touchend:o.End,touchcancel:o.Cancel},nt=["touchstart","touchmove","touchend","touchcancel"];class U extends v{constructor(t,e){super(t,e),this.evTarget=nt,this.targetIds={},this.init()}handler(t){const e=it[t.type],n=this.getTouches(t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:m.Touch,srcEvent:t})}getTouches(t,e){const n=Array.from(t.touches);if(e&(o.Start|o.Move)&&n.length===1){const c=n[0];return this.targetIds[c.identifier]=!0,[n,n]}const s=n.filter(c=>A(c.target,this.target));if(e===o.Start)for(let c=0;c<s.length;c++)this.targetIds[s[c].identifier]=!0;const r=Array.from(t.changedTouches),h=[];for(let c=0;c<s.length;c++)this.targetIds[s[c].identifier]&&h.push(r[c]),(e===o.End||e===o.Cancel)&&delete this.targetIds[r[c].identifier];return h.length?[K(s.concat(h),"identifier",!0),h]:null}}const st={pointerdown:o.Start,pointermove:o.Move,pointerup:o.End,pointercancel:o.Cancel,pointerout:o.Cancel},rt=["pointerdown"],ot=["pointermove","pointerup","pointercancel"];class at extends v{constructor(t,e){super(t,e),this.evEl=rt,this.evWin=ot,this._store=[],this.init()}handler(t){const e=st[t.type],n=t.pointerType===m.Touch;let s=this._store.findIndex(h=>h.pointerId===t.pointerId),r=!1;e&o.Start&&(t.button===0||n)?s===-1&&(this._store.push(t),s=this._store.length-1):e&(o.End|o.Cancel)&&(r=!0),s!==-1&&(this._store[s]=t,this.callback(this.manager,e,{pointers:this._store,changedPointers:[t],pointerType:t.pointerType,srcEvent:t}),r&&this._store.splice(s,1))}}const ht=2500,S=25;class ct extends v{constructor(t,e){super(t,e);const n=J(this.handler,this);this._mouse=new X(t,n),this._touch=new U(t,n),this._primaryTouch=null,this._lastTouches=[]}handler(t,e,n){const s=n.pointerType===m.Touch,r=n.pointerType===m.Mouse;if(s)this._recordTouches(e,n);else if(r&&this._isSyntheticEvent(n))return}destroy(){this._mouse.destroy(),this._touch.destroy()}_recordTouches(t,e){t===o.Start?(this._primaryTouch=e.changedPointers[0].identifier,this._setLastTouch(e)):(t===o.End||t===o.Cancel)&&this._setLastTouch(e)}_setLastTouch(t){const e=t.changedPointers[0];if(e.identifier===this._primaryTouch){const n={x:e.clientX,y:e.clientY};this._lastTouches.push(n);const s=setTimeout(()=>{const r=this._lastTouches.indexOf(n);r>-1&&this._lastTouches.splice(r,1),clearTimeout(s)},ht)}}_isSyntheticEvent(t){const e=t.srcEvent,n=e.clientX,s=e.clientY;for(let r=0;r<this._lastTouches.length;r++){const h=this._lastTouches[r],c=Math.abs(n-h.x),p=Math.abs(s-h.y);if(c<=S&&p<=S)return!0}return!1}}class d{static getAngle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*180/Math.PI}static getDistance(t,e){const n=e.x-t.x,s=e.y-t.y;return Math.sqrt(n*n+s*s)}static getDirection(t,e){return t===e?l.None:Math.abs(t)>=Math.abs(e)?t<0?l.Left:l.Right:e<0?l.Up:l.Down}static getCenter(t){const e=Math.round(t.reduce((s,r)=>s+r.x,0)/t.length),n=Math.round(t.reduce((s,r)=>s+r.y,0)/t.length);return{x:e,y:n}}static getRotation(t,e){return this.getAngle(e[1],e[0])+this.getAngle(t[1],t[0])}static getScale(t,e){return this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1])}static getVelocity(t,e,n){return{x:e/t||0,y:n/t||0}}}const W=i=>{switch(i){case l.Down:return"down";case l.Left:return"left";case l.Right:return"right";case l.Up:return"up"}return""},lt=(i,t,e)=>{const n=e.pointers.length,s=e.changedPointers.length,r=t&o.Start&&n-s===0,h=t&(o.End|o.Cancel)&&n-s===0;e.isFirst=!!r,e.isFinal=!!h,e.isFirst&&i.clearSession(),e.eventType=t,ut(i,e),i.options.preventDefault&&e.srcEvent.preventDefault(),i.options.stopPropagation&&e.srcEvent.stopPropagation(),i.options.stopImmediatePropagation&&e.srcEvent.stopImmediatePropagation(),i.emit(y.Secret,e),i.recognize(e),i.session.prevInput=e},ut=(i,t)=>{var e;const n=i.session,s=t.pointers.length;n.firstInput||(n.firstInput=b(t)),s>1&&!n.firstMultiple?n.firstMultiple=b(t):s===1&&(n.firstMultiple=null);const{firstInput:r,firstMultiple:h}=n,c=h?h.center:r.center,p=[];(e=t.pointers)==null||e.forEach(M=>{p.push({x:Math.round(M.clientX),y:Math.round(M.clientY)})});const g=t.center=d.getCenter(p);t.timestamp=Date.now(),t.deltaTime=t.timestamp-r.timestamp,t.angle=d.getAngle(c,g),t.distance=d.getDistance(c,g),pt(n,t),t.offsetDirection=d.getDirection(t.deltaX,t.deltaY);const u=d.getVelocity(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,t.scale=h?d.getScale(h.pointers,p):1,t.rotation=h?d.getRotation(h.pointers,p):0,t.maxPointers=n.prevInput?Math.max(t.pointers.length,n.prevInput.maxPointers):t.pointers.length;const z=i.element;A(t.srcEvent.target,z)?t.target=t.srcEvent.target:t.target=z,dt(n,t)},b=i=>{const t=[];for(let e=0;e<i.pointers.length;e++)t.push({x:Math.round(i.pointers[e].clientX),y:Math.round(i.pointers[e].clientY)});return{pointers:t,timestamp:Date.now(),center:d.getCenter(t),deltaX:i.deltaX||0,deltaY:i.deltaY||0}},pt=(i,t)=>{const e=t.center;let n=i.offsetDelta||{x:0,y:0},s=i.prevDelta||{x:0,y:0};const r=i.prevInput||{center:e};(t.eventType===o.Start||t.eventType===o.End)&&(s=i.prevDelta={x:r.deltaX||0,y:r.deltaY||0},n=i.offsetDelta={x:e.x,y:e.y}),t.deltaX=s.x+(e.x-n.x),t.deltaY=s.y+(e.y-n.y)},dt=(i,t)=>{const e=i.lastInterval||t,n=t.timestamp-e.timestamp;let s,r,h,c;if(t.eventType!==o.Cancel&&(n>F||e.velocity===void 0)){const p=t.deltaX-e.deltaX,g=t.deltaY-e.deltaY,u=d.getVelocity(n,p,g);r=u.x,h=u.y,s=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,c=d.getDirection(p,g),i.lastInterval=t}else r=e.velocityX,h=e.velocityY,s=e.overallVelocity,c=e.direction;t.velocityX=r,t.velocityY=h,t.velocity=s,t.direction=c},B=i=>{let t;return N?t=at:Y?t=U:I?t=ct:t=X,new t(i,lt)},vt=Object.freeze(Object.defineProperty({__proto__:null,AbstractInput:v,COMPUTE_INTERVAL:F,DIRECTION:l,DIRECTION_HORIZONTAL:D,DIRECTION_VERTICAL:w,INPUT_STATE:o,INPUT_TYPE:m,InputUtil:d,MOBILE_REGEX:O,SUPPORT_ONLY_TOUCH:Y,SUPPORT_POINTER_EVENTS:N,SUPPORT_TOUCH:I,createInputInstance:B,getDirectionStr:W},Symbol.toStringTag,{value:"Module"}));var a=(i=>(i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Canceled=16]="Canceled",i[i.Failed=32]="Failed",i))(a||{}),y=(i=>(i.Secret="touch-fusion.input",i.Unknown="unknown",i.Swipe="swipe",i.Pan="pan",i.Pinch="pinch",i.Rotate="rotate",i.Press="press",i.Tap="tap",i))(y||{});class R{constructor(t){this._type=y.Unknown,this._options={...t},this._id=Z(this.type),this._manager=null,this._options.enable=this._options.enable??!0,this._state=a.Possible,this.simultaneous={},this.requireFails=[]}get type(){return this._type}get id(){return this._id}get state(){return this._state}get options(){return this._options}get hasRequireFailures(){return this.requireFails.length>0}set state(t){this._state=t}set manager(t){this._manager=t}set(t){var e;this._options={...this._options,...t},(e=this._manager)==null||e.touchAction.update()}canRecognizeWith(t){return!!this.simultaneous[t.id]}recognizeWith(t){if(_(t)&&f(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.simultaneous[e.id]&&(this.simultaneous[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(_(t)&&f(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&delete this.simultaneous[e.id],this}requireFailure(t){if(_(t)&&f(t,"requireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.requireFails.includes(e)&&(this.requireFails.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(_(t)&&f(t,"dropRequireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);if(e){const n=this.requireFails.indexOf(e);n>-1&&this.requireFails.splice(n,1)}return this}emit(t){(e=>{var n;(n=this._manager)==null||n.emit(e,t)})(this._type)}tryEmit(t){this.canEmit()&&this.emit(t),this._state=a.Failed}canEmit(){for(const t of this.requireFails)if(t._state!==a.Ended&&t._state!==a.Possible)return!1;return!0}recognize(t){const e={...t};this._options.enable||(this.reset(),this._state=a.Failed),this._state&(a.Ended|a.Canceled|a.Failed)&&(this._state=a.Possible),this._state=this.process(e),this._state&(a.Began|a.Changed|a.Ended|a.Canceled)&&this.tryEmit(e)}getRecognizerByNameIfManager(t,e){return e.manager?e.manager.get(t.type):t}}class q extends R{constructor(t){super(t)}attrTest(t){var e;const{pointers:n}=this.options;return n===0||((e=t.pointers)==null?void 0:e.length)===n}reset(){this.state=a.Possible}process(t){const{eventType:e}=t,n=this.state&(a.Began|a.Changed),s=this.attrTest(t);return n&&(e&o.Cancel||!s)?a.Canceled:n||s?e&o.End?a.Ended:this.state&a.Began?a.Changed:a.Began:a.Failed}}const H=class L extends R{constructor(t={}){super({...L.defaults,...t}),this._timer=null,this._isRecognized=!1,this._type=y.Press}getTouchAction(){return["auto"]}process(t){const e=t.pointers.length===this.options.pointers,n=t.distance<this.options.threshold,s=t.deltaTime>this.options.time;if(!n||!e||t.eventType&(o.End|o.Cancel)&&!s)this.reset();else if(t.eventType&o.Start)this.reset(),this._timer=setTimeout(()=>{this.state=a.Ended,this._isRecognized=!0,this.tryEmit(t)},this.options.time);else if(t.eventType&o.End)return a.Ended;return a.Failed}reset(){this._timer&&clearTimeout(this._timer),this._timer=null}emit(t){this._isRecognized&&(this._isRecognized=!1,t.deltaTime=Date.now()-t.timestamp,t.timestamp=Date.now(),super.emit(t))}};H.defaults={threshold:9,pointers:1,time:251};let gt=H;const V=class j extends q{constructor(t={}){super({...j.defaults,...t}),this._type=y.Pan,this._dX=null,this._dY=null}getTouchAction(){const{direction:t}=this.options,e=[];return t&l.Horizontal&&e.push("pan-y"),t&l.Vertical&&e.push("pan-x"),e}attrTest(t){return!!(super.attrTest(t)&&(this.state&a.Began||!(this.state&a.Began)&&this._directionTest(t)))}emit(t){this._dX=t.deltaX||0,this._dY=t.deltaY||0;const e=W(t.direction);e&&(t.additionalEvent=`${this._type}-${e}`),super.emit(t)}_directionTest(t){let e=!0;const{deltaX:n,deltaY:s}=t;return t.direction&this.options.direction||(this.options.direction&l.Horizontal?(t.direction=n===0?l.None:n<0?l.Left:l.Right,t.distance=Math.abs(n),e=n!==this._dX):(t.direction=s===0?l.None:s<0?l.Up:l.Down,t.distance=Math.abs(s),e=s!==this._dY)),!!(e&&this.options.direction&t.direction&&t.distance>this.options.threshold)}};V.defaults={pointers:1,threshold:10,direction:l.All};let _t=V;const ft=Object.freeze(Object.defineProperty({__proto__:null,AttrRecognizer:q,PanRecognizer:_t,PressRecognizer:gt,RECOGNIZER_STATE:a,RECOGNIZER_TYPE:y,Recognizer:R},Symbol.toStringTag,{value:"Module"}));var T=(i=>(i[i.Stop=1]="Stop",i[i.ForceStop=2]="ForceStop",i))(T||{});const mt={domEvents:!1,touchActions:["compute"],enable:!0,preventDefault:!1,stopPropagation:!1,stopImmediatePropagation:!1,inputTarget:null,cssProps:{userSelect:"none"}};class yt{constructor(t,e){this.manager=t,this.actions=[...e],this.set(e)}set(t){t.includes("compute")&&(t=this._compute());const e=t.join(" ");this.manager.element.style.touchAction=e.toLowerCase().trim()}update(){this.manager.options.touchActions&&this.set([...this.manager.options.touchActions])}preventDefault(t){const{srcEvent:e}=t,n=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}const s=this.actions.includes("none"),r=this.actions.includes("pan-x"),h=this.actions.includes("pan-y");if(s){const c=t.pointers.length===1,p=t.distance<2,g=t.deltaTime<250;if(c&&p&&g)return}r&&h||(s||r&&n&D||h&&n&w)&&this._preventSrc(e)}_compute(){let t=[];return this.manager.recognizers.forEach(e=>{k(e.options.enable)&&e.options.enable&&(t=t.concat(e.getTouchAction()))}),this._cleanTouchActions(t)}_cleanTouchActions(t){if(t.includes("none"))return["none"];const e=t.includes("pan-x"),n=t.includes("pan-y");return e&&n?["none"]:e||n?e?["pan-x"]:["pan-y"]:t.includes("manipulation")?["manipulation"]:["auto"]}_preventSrc(t){this.manager.session.prevented=!0,t.preventDefault()}}class Tt{constructor(t,e){this._element=t,this._options={...mt,...e},this._options.inputTarget=(e==null?void 0:e.inputTarget)??this._element,this._recognizers=[],this._input=B(this),this._session={},this.handlers={},this._touchAction=new yt(this,this._options.touchActions),this._oldCssProps={},this._toggleCssProps("add")}get element(){return this._element}get options(){return this._options}get recognizers(){return this._recognizers}get session(){return this._session}get touchAction(){return this._touchAction}stop(t){this._session.stopped=t?T.ForceStop:T.Stop}set(t){return this._options={...this._options,...t},t.touchActions&&this._touchAction.update(),t.inputTarget&&(this._input.destroy(),this._input.target=t.inputTarget,this._input.init()),this}get(t){return this._recognizers.find(e=>e.type===t)||null}add(t){t.manager=this,this._recognizers.push(t)}remove(t){const e=this._recognizers.findIndex(n=>n.type===t.type);e>-1&&this._recognizers.splice(e,1)}on(t,e){this.handlers[t]=e}off(t){t.forEach(e=>{delete this.handlers[e]})}destroy(){this._toggleCssProps("remove"),this._recognizers=[],this._input.destroy(),this._session={},this.handlers={}}recognize(t){if(this._session.stopped)return;this.touchAction.preventDefault(t);let{curRecognizer:e}=this._session;(!e||e&&e.state&a.Ended)&&(e=this._session.curRecognizer=null);for(let n=0;n<this._recognizers.length;n++){const s=this._recognizers[n];this._session.stopped!==T.ForceStop&&(!e||s===e||s.canRecognizeWith(e))?s.recognize(t):s.reset(),!e&&s.state&(a.Began|a.Changed|a.Ended)&&(e=this._session.curRecognizer=s)}}emit(t,e){const n=this.handlers[t];e.type=t,e.preventDefault=()=>{var s;(s=e.srcEvent)==null||s.preventDefault()},n&&n(e)}clearSession(){this._session={}}_toggleCssProps(t){!this._options.cssProps||!this._element.style||(E(this._options.cssProps,(e,n)=>{t==="add"?(this._oldCssProps[n]=this._element.style[n],this._element.style[n]=e):this._element.style[n]=this._oldCssProps[n]||""}),t!=="add"&&(this._oldCssProps={}))}}export{vt as _,ft as m,Tt as y};
