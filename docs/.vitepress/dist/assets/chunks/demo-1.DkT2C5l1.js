import{E as Q}from"./theme.gmE4R2lj.js";import{d as tt,h as et,l as nt,o as it,c as st,_ as ot}from"./framework.DRO9vf8U.js";var v=(n=>(n[n.Stop=1]="Stop",n[n.ForceStop=2]="ForceStop",n))(v||{}),_=(n=>(n[n.None=1]="None",n[n.Left=2]="Left",n[n.Right=4]="Right",n[n.Up=8]="Up",n[n.Down=16]="Down",n[n.Horizontal=6]="Horizontal",n[n.Vertical=24]="Vertical",n[n.All=30]="All",n))(_||{});const N=6,D=24;var a=(n=>(n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel",n))(a||{}),m=(n=>(n.Touch="touch",n.Mouse="mouse",n.Pen="pen",n.Kinect="kinect",n))(m||{});const F=25,L=/mobile|tablet|ip(ad|hone|od)|android/i,S="ontouchstart"in window||navigator.maxTouchPoints>0,rt="PointerEvent"in window,U=S&&L.test(navigator.userAgent);var r=(n=>(n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Canceled=16]="Canceled",n[n.Failed=32]="Failed",n))(r||{}),y=(n=>(n.Secret="touch-fusion.input",n.Unknown="unknown",n.Swipe="swipe",n.Pan="pan",n.Pinch="pinch",n.Rotate="rotate",n.Press="press",n.Tap="tap",n))(y||{}),Y=(n=>(n.COMPUTE="compute",n.AUTO="auto",n.MANIPULATION="manipulation",n.NONE="none",n.PAN_X="pan-x",n.PAN_Y="pan-y",n))(Y||{});const at=["none","pan-x","pan-y","auto","manipulation","compute"],j={domEvents:!1,touchActions:["compute"],enable:!0,preventDefault:!1,stopPropagation:!1,stopImmediatePropagation:!1,inputTarget:null,cssProps:{userSelect:"none"}},ct=Object.freeze(Object.defineProperty({__proto__:null,ACTIONS:at,COMPUTE_INTERVAL:F,DEFAULT_OPTIONS:j,DIRECTION:_,DIRECTION_HORIZONTAL:N,DIRECTION_VERTICAL:D,INPUT_STATE:a,INPUT_TYPE:m,MOBILE_REGEX:L,RECOGNIZER_STATE:r,RECOGNIZER_TYPE:y,STOP_TYPE:v,SUPPORT_ONLY_TOUCH:U,SUPPORT_POINTER_EVENTS:rt,SUPPORT_TOUCH:S,TOUCH_ACTION:Y},Symbol.toStringTag,{value:"Module"})),ht=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class M extends Error{constructor(t){super(t),this.name="TouchFusionError",Error.captureStackTrace&&Error.captureStackTrace(this,M)}}const lt=n=>{throw new M(n)},ut=n=>{console.warn(`[TouchFusionWarning]: ${n}`)},W=n=>typeof n=="boolean",pt=n=>typeof n=="number",C=n=>typeof n=="string",B=n=>typeof n=="function",X=n=>n===null||Object.prototype.toString.call(n)==="[object Array]"?!1:typeof n=="object",d=n=>Array.isArray(n),dt=n=>n instanceof Element,gt=n=>n instanceof HTMLElement,_t=n=>n instanceof TouchEvent,mt=n=>n instanceof MouseEvent,ft=n=>n instanceof PointerEvent,vt=n=>n instanceof TouchList,yt=n=>n!==void 0,Tt=n=>n===void 0,Et=n=>n===null,Pt=n=>n==null,q=n=>`${n}-${Date.now()}-${Math.floor(Math.random()*1e5)}`,T=(n,t,e)=>{if(!(!X(n)&&!d(n)))if(d(n))n.forEach(t,e);else for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.call(e,n[i],i,n)},f=(n,t,e)=>!d(n)||!B(e[t])?!1:(T(n,e[t],e),!0),H=(n,t,e=!1)=>{const i=[],s=[];for(let o=0;o<n.length;o++){const c=t?n[o][t]:n[o];s.indexOf(c)===-1&&i.push(n[o]),s[o]=c}return e&&(t?i.sort((o,c)=>o[t]>c[t]?1:-1):i.sort()),i},E=(n,t,e)=>{T(t,i=>{C(i)&&n.addEventListener(i,e,!1)})},P=(n,t,e)=>{T(t,i=>{C(i)&&n.removeEventListener(i,e,!1)})},I=(n,t)=>{for(;n;){if(n===t)return!0;n=n.parentNode}return!1},k=(n,t)=>function(...e){return n.apply(t,e)},bt=Object.freeze(Object.defineProperty({__proto__:null,addEventListener:E,bindFn:k,each:T,generateId:q,hasParentNode:I,invokeArrayArg:f,isArray:d,isBoolean:W,isDefined:yt,isElement:dt,isFunction:B,isHTMLElement:gt,isMouseEvent:mt,isNil:Pt,isNull:Et,isNumber:pt,isObject:X,isPointerEvent:ft,isString:C,isTouchEvent:_t,isTouchList:vt,isUndefined:Tt,removeEventListener:P,throwError:lt,throwWarning:ut,uniqueArray:H},Symbol.toStringTag,{value:"Module"}));class z{constructor(t,e){this._evEl=[],this._evWin=[],this._evTarget=[],this._manager=t,this.el=t.element,this._target=t.options.inputTarget,this.callback=e,this.domHandler=i=>{this._manager.options.enable&&this.handler(i)}}get manager(){return this._manager}get target(){return this._target}set evEl(t){this._evEl=t}set evWin(t){this._evWin=t}set evTarget(t){this._evTarget=t}init(){this._evEl.length!==0&&E(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&E(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&E(window,this._evWin,this.domHandler)}destroy(){this._evEl.length!==0&&P(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&P(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&P(window,this._evWin,this.domHandler)}}const St={mousedown:a.Start,mousemove:a.Move,mouseup:a.End},Mt=["mousedown"],Ct=["mousemove","mouseup"];class V extends z{constructor(t,e){super(t,e),this.evEl=Mt,this.evWin=Ct,this._pressed=!1,this.init()}handler(t){const e=St[t.type];e===a.Start&&t.button===0&&(this._pressed=!0),this._pressed&&(e===a.End&&(this._pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:m.Mouse,srcEvent:t}))}}const It={touchstart:a.Start,touchmove:a.Move,touchend:a.End,touchcancel:a.Cancel},zt=["touchstart","touchmove","touchend","touchcancel"];class G extends z{constructor(t,e){super(t,e),this.evTarget=zt,this.targetIds={},this.init()}handler(t){const e=It[t.type],i=this.getTouches(t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:m.Touch,srcEvent:t})}getTouches(t,e){const i=Array.from(t.touches);if(e&(a.Start|a.Move)&&i.length===1){const h=i[0];return this.targetIds[h.identifier]=!0,[i,i]}const s=i.filter(h=>I(h.target,this.target));if(e===a.Start)for(let h=0;h<s.length;h++)this.targetIds[s[h].identifier]=!0;const o=Array.from(t.changedTouches),c=[];for(let h=0;h<s.length;h++)this.targetIds[s[h].identifier]&&c.push(o[h]),(e===a.End||e===a.Cancel)&&delete this.targetIds[o[h].identifier];return c.length?[H(s.concat(c),"identifier",!0),c]:null}}const Rt=2500,A=25;class xt extends z{constructor(t,e){super(t,e);const i=k(this.handler,this);this._mouse=new V(t,i),this._touch=new G(t,i),this._primaryTouch=null,this._lastTouches=[]}handler(t,e,i){const s=i.pointerType===m.Touch,o=i.pointerType===m.Mouse;if(s)this._recordTouches(e,i);else if(o&&this._isSyntheticEvent(i))return}destroy(){this._mouse.destroy(),this._touch.destroy()}_recordTouches(t,e){t===a.Start?(this._primaryTouch=e.changedPointers[0].identifier,this._setLastTouch(e)):(t===a.End||t===a.Cancel)&&this._setLastTouch(e)}_setLastTouch(t){const e=t.changedPointers[0];if(e.identifier===this._primaryTouch){const i={x:e.clientX,y:e.clientY};this._lastTouches.push(i);const s=setTimeout(()=>{const o=this._lastTouches.indexOf(i);o>-1&&this._lastTouches.splice(o,1),clearTimeout(s)},Rt)}}_isSyntheticEvent(t){const e=t.srcEvent,i=e.clientX,s=e.clientY;for(let o=0;o<this._lastTouches.length;o++){const c=this._lastTouches[o],h=Math.abs(i-c.x),u=Math.abs(s-c.y);if(h<=A&&u<=A)return!0}return!1}}class p{static getAngle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*180/Math.PI}static getDistance(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}static getDirection(t,e){return t===e?_.None:Math.abs(t)>=Math.abs(e)?t<0?_.Left:_.Right:e<0?_.Up:_.Down}static getCenter(t){const e=Math.round(t.reduce((s,o)=>s+o.x,0)/t.length),i=Math.round(t.reduce((s,o)=>s+o.y,0)/t.length);return{x:e,y:i}}static getRotation(t,e){return this.getAngle(e[1],e[0])+this.getAngle(t[1],t[0])}static getScale(t,e){return this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1])}static getVelocity(t,e,i){return{x:e/t||0,y:i/t||0}}}const Ot=(n,t,e)=>{const i=e.pointers.length,s=e.changedPointers.length,o=t&a.Start&&i-s===0,c=t&(a.End|a.Cancel)&&i-s===0;e.isFirst=!!o,e.isFinal=!!c,o&&n.clearSession(),e.eventType=t,At(n,e),n.options.preventDefault&&e.srcEvent.preventDefault(),n.options.stopPropagation&&e.srcEvent.stopPropagation(),n.options.stopImmediatePropagation&&e.srcEvent.stopImmediatePropagation(),n.emit(y.Secret,e),n.recognize(e),n.session.prevInput=e},At=(n,t)=>{var e;const i=n.session,s=t.pointers.length;i.firstInput||(i.firstInput=w(t)),s>1&&!i.firstMultiple?i.firstMultiple=w(t):s===1&&(i.firstMultiple=null);const{firstInput:o,firstMultiple:c}=i,h=c?c.center:o.center,u=[];(e=t.pointers)==null||e.forEach(O=>{u.push({x:Math.round(O.clientX),y:Math.round(O.clientY)})});const g=t.center=p.getCenter(u);t.timestamp=Date.now(),t.deltaTime=t.timestamp-o.timestamp,t.angle=p.getAngle(h,g),t.distance=p.getDistance(h,g),wt(i,t),t.offsetDirection=p.getDirection(t.deltaX,t.deltaY);const l=p.getVelocity(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=Math.abs(l.x)>Math.abs(l.y)?l.x:l.y,t.scale=c?p.getScale(c.pointers,u):1,t.rotation=c?p.getRotation(c.pointers,u):0,t.maxPointers=i.prevInput?Math.max(t.pointers.length,i.prevInput.maxPointers):t.pointers.length;const x=n.element;I(t.srcEvent.target,x)?t.target=t.srcEvent.target:t.target=x,Nt(i,t)},w=n=>{const t=[];for(let e=0;e<n.pointers.length;e++)t.push({x:Math.round(n.pointers[e].clientX),y:Math.round(n.pointers[e].clientY)});return{pointers:t,timestamp:Date.now(),center:p.getCenter(t),deltaX:n.deltaX||0,deltaY:n.deltaY||0}},wt=(n,t)=>{const e=t.center;let i=n.offsetDelta||{x:0,y:0},s=n.prevDelta||{x:0,y:0};const o=n.prevInput||{center:e};(t.eventType===a.Start||t.eventType===a.End)&&(s=n.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=n.offsetDelta={x:e.x,y:e.y}),t.deltaX=s.x+(e.x-i.x),t.deltaY=s.y+(e.y-i.y)},Nt=(n,t)=>{const e=n.lastInterval||t,i=t.timestamp-e.timestamp;let s,o,c,h;if(t.eventType!==a.Cancel&&(i>F||e.velocity===void 0)){const u=t.deltaX-e.deltaX,g=t.deltaY-e.deltaY,l=p.getVelocity(i,u,g);o=l.x,c=l.y,s=Math.abs(l.x)>Math.abs(l.y)?l.x:l.y,h=p.getDirection(u,g),n.lastInterval=t}else o=e.velocityX,c=e.velocityY,s=e.overallVelocity,h=e.direction;t.velocityX=o,t.velocityY=c,t.velocity=s,t.direction=h},Z=n=>{let t;return U?t=G:S?t=xt:t=V,new t(n,Ot)},Dt=Object.freeze(Object.defineProperty({__proto__:null,InputUtil:p,createInputInstance:Z},Symbol.toStringTag,{value:"Module"}));class R{constructor(t){this._type=y.Unknown,this._options={...t},this._id=q(this.type),this._manager=null,this._options.enable=this._options.enable??!0,this._state=r.Possible,this.simultaneous={},this.requireFails=[]}get type(){return this._type}get id(){return this._id}get state(){return this._state}get options(){return this._options}get hasRequireFailures(){return this.requireFails.length>0}set state(t){this._state=t}set manager(t){this._manager=t}set(t){var e;this._options={...this._options,...t},(e=this._manager)==null||e.touchAction.update()}canRecognizeWith(t){return!!this.simultaneous[t.id]}recognizeWith(t){if(d(t)&&f(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.simultaneous[e.id]&&(this.simultaneous[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(d(t)&&f(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&delete this.simultaneous[e.id],this}requireFailure(t){if(d(t)&&f(t,"requireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.requireFails.includes(e)&&(this.requireFails.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(d(t)&&f(t,"dropRequireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);if(e){const i=this.requireFails.indexOf(e);i>-1&&this.requireFails.splice(i,1)}return this}emit(t){(e=>{var i;(i=this._manager)==null||i.emit(e,t)})(this._type)}tryEmit(t){this.canEmit()&&this.emit(t),this._state=r.Failed}canEmit(){for(const t of this.requireFails)if(t._state!==r.Ended&&t._state!==r.Possible)return!1;return!0}recognize(t){const e={...t};this._options.enable||(this.reset(),this._state=r.Failed),this._state&(r.Ended|r.Canceled|r.Failed)&&(this._state=r.Possible),this._state=this.process(e),this._state&(r.Began|r.Changed|r.Ended|r.Canceled)&&this.tryEmit(e)}getRecognizerByNameIfManager(t,e){return e.manager?e.manager.get(t.type):t}}class Ft extends R{constructor(t){super(t)}attrTest(t){var e;const{pointers:i}=this.options;return i===0||((e=t.pointers)==null?void 0:e.length)===i}reset(){this.state=r.Possible}process(t){const{eventType:e}=t,i=this.state&(r.Began|r.Changed),s=this.attrTest(t);return i&&(e&a.Cancel||!s)?r.Canceled:i||s?e&a.End?r.Ended:this.state&r.Began?r.Changed:r.Began:r.Failed}}const $=class K extends R{constructor(t={}){super({...K.defaults,...t}),this._timer=null,this._isRecognized=!1,this._type=y.Press}getTouchAction(){return["auto"]}process(t){const e=t.pointers.length===this.options.pointers,i=t.distance<this.options.threshold,s=t.deltaTime>this.options.time;if(!i||!e||t.eventType&(a.End|a.Cancel)&&!s)this.reset();else if(t.eventType&a.Start)this.reset(),this._timer=setTimeout(()=>{this.state=r.Ended,this._isRecognized=!0,this.tryEmit(t)},this.options.time);else if(t.eventType&a.End)return r.Ended;return r.Failed}reset(){this._timer&&clearTimeout(this._timer),this._timer=null}emit(t){this._isRecognized&&(this._isRecognized=!1,super.emit(t))}};$.defaults={threshold:9,pointers:1,time:251};let Lt=$;const Ut=Object.freeze(Object.defineProperty({__proto__:null,AttrRecognizer:Ft,PressRecognizer:Lt,Recognizer:R},Symbol.toStringTag,{value:"Module"}));class J{constructor(t,e){this.manager=t,this.actions=[...e],this.set(e)}set(t){const e=t.join(" ");this.manager.element.style.touchAction=e.toLowerCase().trim()}update(){this.manager.options.touchActions&&this.set([...this.manager.options.touchActions])}compute(){let t=[];return this.manager.recognizers.forEach(e=>{W(e.options.enable)&&e.options.enable&&(t=t.concat(e.getTouchAction()))}),this.cleanTouchActions(t)}preventDefault(t){const{srcEvent:e}=t,i=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}const s=this.actions.includes("none"),o=this.actions.includes("pan-x"),c=this.actions.includes("pan-y");if(s){const h=t.pointers.length===1,u=t.distance<2,g=t.deltaTime<250;if(h&&u&&g)return}if(!(o&&c)&&(s||o&&i===N||c&&i===D))return this.preventSrc(e)}cleanTouchActions(t){if(t.includes("none"))return"none";const e=t.includes("pan-x"),i=t.includes("pan-y");return e&&i?"none":e||i?e?"pan-x":"pan-y":t.includes("manipulation")?"manipulation":"auto"}preventSrc(t){this.manager.session.prevented=!0,t.preventDefault()}}const Yt=Object.freeze(Object.defineProperty({__proto__:null,TouchAction:J},Symbol.toStringTag,{value:"Module"}));class jt{constructor(t,e){this._element=t,this._options={...j,...e},this._options.inputTarget=(e==null?void 0:e.inputTarget)??this._element,this._recognizers=[],this._input=Z(this),this._touchAction=new J(this,this._options.touchActions),this._session={},this.handlers={},this._oldCssProps={},this._toggleCssProps("add")}get element(){return this._element}get options(){return this._options}get recognizers(){return this._recognizers}get session(){return this._session}get touchAction(){return this._touchAction}stop(t){this._session.stopped=t?v.ForceStop:v.Stop}set(t){this._options={...this._options,...t}}get(t){return this._recognizers.find(e=>e.type===t)||null}add(t){t.manager=this,this._recognizers.push(t)}remove(t){const e=this._recognizers.findIndex(i=>i.type===t.type);e>-1&&this._recognizers.splice(e,1)}on(t,e){t.forEach(i=>{this.handlers[i]=e})}off(t){t.forEach(e=>{delete this.handlers[e]})}destroy(){this._toggleCssProps("remove"),this._recognizers=[],this._input.destroy(),this._session={},this.handlers={}}recognize(t){if(this._session.stopped)return;this.touchAction.preventDefault(t);let{curRecognizer:e}=this._session;(!e||e&&e.state===r.Ended)&&(e=this._session.curRecognizer=null);for(let i=0;i<this._recognizers.length;i++){const s=this._recognizers[i];this._session.stopped!==v.ForceStop&&(!e||s===e||s.canRecognizeWith(e))?s.recognize(t):s.reset(),!e&&s.state&(r.Began|r.Changed|r.Ended)&&(e=this._session.curRecognizer=s)}}emit(t,e){const i=this.handlers[t];e.type=t,e.preventDefault=()=>{var s;(s=e.srcEvent)==null||s.preventDefault()},i&&i(e)}clearSession(){this._session={}}_toggleCssProps(t){!this._options.cssProps||!this._element.style||(T(this._options.cssProps,(e,i)=>{t==="add"?(this._oldCssProps[i]=this._element.style[i],this._element.style[i]=e):this._element.style[i]=this._oldCssProps[i]||""}),t!=="add"&&(this._oldCssProps={}))}}const Wt=Object.freeze(Object.defineProperty({__proto__:null,Input:Dt,Manager:jt,Recognizer:Ut,TouchAction:Yt},Symbol.toStringTag,{value:"Module"})),b={Constants:ct,Types:ht,Utils:bt,Core:Wt},Bt=tt({__name:"demo-1",setup(n){const t=et(null);return nt(()=>{const e=new b.Core.Manager(t.value,{preventDefault:!0}),i=new b.Core.Recognizer.PressRecognizer({threshold:5,time:1e3});e.add(i),e.on([b.Constants.RECOGNIZER_TYPE.Press],s=>{console.log(s),Q.success("检测到长按手势触发了！")})}),(e,i)=>(it(),st("div",{ref_key:"detectRef",ref:t,class:"press-detect-area"}," 手势触发区域 ",512))}}),Ht=ot(Bt,[["__scopeId","data-v-ff2f86ae"]]);export{Ht as default};
