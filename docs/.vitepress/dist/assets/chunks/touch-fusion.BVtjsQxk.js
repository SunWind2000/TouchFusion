const J=i=>typeof i=="boolean",A=i=>typeof i=="string",Q=i=>typeof i=="function",tt=i=>i===null||Object.prototype.toString.call(i)==="[object Array]"?!1:typeof i=="object",m=i=>Array.isArray(i),et=i=>`${i}-${Date.now()}-${Math.floor(Math.random()*1e5)}`,E=(i,t,e)=>{if(!(!tt(i)&&!m(i)))if(m(i))i.forEach(t,e);else for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&t.call(e,i[s],s,i)},f=(i,t,e)=>!m(i)||!Q(e[t])?!1:(E(i,e[t],e),!0),it=(i,t,e=!1)=>{const s=[],n=[];for(let o=0;o<i.length;o++){const h=t?i[o][t]:i[o];n.indexOf(h)===-1&&s.push(i[o]),n[o]=h}return e&&(t?s.sort((o,h)=>o[t]>h[t]?1:-1):s.sort()),s},P=(i,t,e)=>{E(t,s=>{A(s)&&i.addEventListener(s,e,!1)})},z=(i,t,e)=>{E(t,s=>{A(s)&&i.removeEventListener(s,e,!1)})},D=(i,t)=>{for(;i;){if(i===t)return!0;i=i.parentNode}return!1},st=(i,t)=>function(...e){return i.apply(t,e)};class v{constructor(t,e){this._evEl=[],this._evWin=[],this._evTarget=[],this._manager=t,this.el=t.element,this._target=t.options.inputTarget,this.callback=e,this.domHandler=s=>{this._manager.options.enable&&this.handler(s)}}get manager(){return this._manager}get target(){return this._target}set evEl(t){this._evEl=t}set evWin(t){this._evWin=t}set evTarget(t){this._evTarget=t}set target(t){this._target=t}init(){this._evEl.length!==0&&P(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&P(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&P(window,this._evWin,this.domHandler)}destroy(){this._evEl.length!==0&&z(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&z(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&z(window,this._evWin,this.domHandler)}}var c=(i=>(i[i.None=1]="None",i[i.Left=2]="Left",i[i.Right=4]="Right",i[i.Up=8]="Up",i[i.Down=16]="Down",i[i.Horizontal=6]="Horizontal",i[i.Vertical=24]="Vertical",i[i.All=30]="All",i))(c||{});const F=6,O=24;var r=(i=>(i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel",i))(r||{}),y=(i=>(i.Touch="touch",i.Mouse="mouse",i.Pen="pen",i.Kinect="kinect",i))(y||{});const Y=25,N=/mobile|tablet|ip(ad|hone|od)|android/i,x="ontouchstart"in window||navigator.maxTouchPoints>0,X="PointerEvent"in window,V=x&&N.test(navigator.userAgent),nt={mousedown:r.Start,mousemove:r.Move,mouseup:r.End},ot=["mousedown"],rt=["mousemove","mouseup"];class H extends v{constructor(t,e){super(t,e),this.evEl=ot,this.evWin=rt,this._pressed=!1,this.init()}handler(t){const e=nt[t.type];e===r.Start&&t.button===0&&(this._pressed=!0),this._pressed&&(e===r.End&&(this._pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:y.Mouse,srcEvent:t}))}}const at={touchstart:r.Start,touchmove:r.Move,touchend:r.End,touchcancel:r.Cancel},ht=["touchstart","touchmove","touchend","touchcancel"];class L extends v{constructor(t,e){super(t,e),this.evTarget=ht,this.targetIds={},this.init()}handler(t){const e=at[t.type],s=this.getTouches(t,e);s&&this.callback(this.manager,e,{pointers:s[0],changedPointers:s[1],pointerType:y.Touch,srcEvent:t})}getTouches(t,e){const s=Array.from(t.touches);if(e&(r.Start|r.Move)&&s.length===1){const l=s[0];return this.targetIds[l.identifier]=!0,[s,s]}const n=s.filter(l=>D(l.target,this.target));if(e===r.Start)for(let l=0;l<n.length;l++)this.targetIds[n[l].identifier]=!0;const o=Array.from(t.changedTouches),h=[];for(let l=0;l<n.length;l++)this.targetIds[n[l].identifier]&&h.push(o[l]),(e===r.End||e===r.Cancel)&&delete this.targetIds[o[l].identifier];return h.length?[it(n.concat(h),"identifier",!0),h]:null}}const ct={pointerdown:r.Start,pointermove:r.Move,pointerup:r.End,pointercancel:r.Cancel,pointerout:r.Cancel},lt=["pointerdown"],ut=["pointermove","pointerup","pointercancel"];class pt extends v{constructor(t,e){super(t,e),this.evEl=lt,this.evWin=ut,this._store=[],this.init()}handler(t){const e=ct[t.type],s=t.pointerType===y.Touch;let n=this._store.findIndex(h=>h.pointerId===t.pointerId),o=!1;e&r.Start&&(t.button===0||s)?n===-1&&(this._store.push(t),n=this._store.length-1):e&(r.End|r.Cancel)&&(o=!0),n!==-1&&(this._store[n]=t,this.callback(this.manager,e,{pointers:this._store,changedPointers:[t],pointerType:t.pointerType,srcEvent:t}),o&&this._store.splice(n,1))}}const dt=2500,w=25;class gt extends v{constructor(t,e){super(t,e);const s=st(this.handler,this);this._mouse=new H(t,s),this._touch=new L(t,s),this._primaryTouch=null,this._lastTouches=[]}handler(t,e,s){const n=s.pointerType===y.Touch,o=s.pointerType===y.Mouse;if(n)this._recordTouches(e,s);else if(o&&this._isSyntheticEvent(s))return}destroy(){this._mouse.destroy(),this._touch.destroy()}_recordTouches(t,e){t===r.Start?(this._primaryTouch=e.changedPointers[0].identifier,this._setLastTouch(e)):(t===r.End||t===r.Cancel)&&this._setLastTouch(e)}_setLastTouch(t){const e=t.changedPointers[0];if(e.identifier===this._primaryTouch){const s={x:e.clientX,y:e.clientY};this._lastTouches.push(s);const n=setTimeout(()=>{const o=this._lastTouches.indexOf(s);o>-1&&this._lastTouches.splice(o,1),clearTimeout(n)},dt)}}_isSyntheticEvent(t){const e=t.srcEvent,s=e.clientX,n=e.clientY;for(let o=0;o<this._lastTouches.length;o++){const h=this._lastTouches[o],l=Math.abs(s-h.x),p=Math.abs(n-h.y);if(l<=w&&p<=w)return!0}return!1}}class d{static getAngle(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*180/Math.PI}static getDistance(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)}static getDirection(t,e){return t===e?c.None:Math.abs(t)>=Math.abs(e)?t<0?c.Left:c.Right:e<0?c.Up:c.Down}static getCenter(t){const e=Math.round(t.reduce((n,o)=>n+o.x,0)/t.length),s=Math.round(t.reduce((n,o)=>n+o.y,0)/t.length);return{x:e,y:s}}static getRotation(t,e){return this.getAngle(e[1],e[0])+this.getAngle(t[1],t[0])}static getScale(t,e){return this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1])}static getVelocity(t,e,s){return{x:e/t||0,y:s/t||0}}}const b=i=>{switch(i){case c.Down:return"down";case c.Left:return"left";case c.Right:return"right";case c.Up:return"up"}return""},_t=(i,t,e)=>{const s=e.pointers.length,n=e.changedPointers.length,o=t&r.Start&&s-n===0,h=t&(r.End|r.Cancel)&&s-n===0;e.isFirst=!!o,e.isFinal=!!h,e.isFirst&&i.clearSession(),e.eventType=t,mt(i,e),i.options.preventDefault&&e.srcEvent.preventDefault(),i.options.stopPropagation&&e.srcEvent.stopPropagation(),i.options.stopImmediatePropagation&&e.srcEvent.stopImmediatePropagation(),i.emit(g.Secret,e),i.recognize(e),i.session.prevInput=e},mt=(i,t)=>{var e;const s=i.session,n=t.pointers.length;s.firstInput||(s.firstInput=C(t)),n>1&&!s.firstMultiple?s.firstMultiple=C(t):n===1&&(s.firstMultiple=null);const{firstInput:o,firstMultiple:h}=s,l=h?h.center:o.center,p=[];(e=t.pointers)==null||e.forEach(S=>{p.push({x:Math.round(S.clientX),y:Math.round(S.clientY)})});const _=t.center=d.getCenter(p);t.timestamp=Date.now(),t.deltaTime=t.timestamp-o.timestamp,t.angle=d.getAngle(l,_),t.distance=d.getDistance(l,_),yt(s,t),t.offsetDirection=d.getDirection(t.deltaX,t.deltaY);const u=d.getVelocity(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=u.x,t.overallVelocityY=u.y,t.overallVelocity=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,t.scale=h?d.getScale(h.pointers,p):1,t.rotation=h?d.getRotation(h.pointers,p):0,t.maxPointers=s.prevInput?Math.max(t.pointers.length,s.prevInput.maxPointers):t.pointers.length;const M=i.element;D(t.srcEvent.target,M)?t.target=t.srcEvent.target:t.target=M,vt(s,t)},C=i=>{const t=[];for(let e=0;e<i.pointers.length;e++)t.push({x:Math.round(i.pointers[e].clientX),y:Math.round(i.pointers[e].clientY)});return{pointers:t,timestamp:Date.now(),center:d.getCenter(t),deltaX:i.deltaX||0,deltaY:i.deltaY||0}},yt=(i,t)=>{const e=t.center;let s=i.offsetDelta||{x:0,y:0},n=i.prevDelta||{x:0,y:0};const o=i.prevInput||{center:e};(t.eventType===r.Start||t.eventType===r.End)&&(n=i.prevDelta={x:o.deltaX||0,y:o.deltaY||0},s=i.offsetDelta={x:e.x,y:e.y}),t.deltaX=n.x+(e.x-s.x),t.deltaY=n.y+(e.y-s.y)},vt=(i,t)=>{const e=i.lastInterval||t,s=t.timestamp-e.timestamp;let n,o,h,l;if(t.eventType!==r.Cancel&&(s>Y||e.velocity===void 0)){const p=t.deltaX-e.deltaX,_=t.deltaY-e.deltaY,u=d.getVelocity(s,p,_);o=u.x,h=u.y,n=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,l=d.getDirection(p,_),i.lastInterval=t}else o=e.velocityX,h=e.velocityY,n=e.overallVelocity,l=e.direction;t.velocityX=o,t.velocityY=h,t.velocity=n,t.direction=l},U=i=>{let t;return X?t=pt:V?t=L:x?t=gt:t=H,new t(i,_t)},Et=Object.freeze(Object.defineProperty({__proto__:null,AbstractInput:v,COMPUTE_INTERVAL:Y,DIRECTION:c,DIRECTION_HORIZONTAL:F,DIRECTION_VERTICAL:O,INPUT_STATE:r,INPUT_TYPE:y,InputUtil:d,MOBILE_REGEX:N,SUPPORT_ONLY_TOUCH:V,SUPPORT_POINTER_EVENTS:X,SUPPORT_TOUCH:x,createInputInstance:U,getDirectionStr:b},Symbol.toStringTag,{value:"Module"}));var a=(i=>(i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Canceled=16]="Canceled",i[i.Failed=32]="Failed",i))(a||{}),g=(i=>(i.Secret="touch-fusion.input",i.Unknown="unknown",i.Swipe="swipe",i.Pan="pan",i.Pinch="pinch",i.Rotate="rotate",i.Press="press",i.Tap="tap",i))(g||{});class R{constructor(t){this._type=g.Unknown,this._options={...t},this._id=et(this.type),this._manager=null,this._options.enable=this._options.enable??!0,this._state=a.Possible,this.simultaneous={},this.requireFails=[]}get type(){return this._type}get id(){return this._id}get state(){return this._state}get options(){return this._options}get hasRequireFailures(){return this.requireFails.length>0}set state(t){this._state=t}set manager(t){this._manager=t}set(t){var e;this._options={...this._options,...t},(e=this._manager)==null||e.touchAction.update()}canRecognizeWith(t){return!!this.simultaneous[t.id]}recognizeWith(t){if(m(t)&&f(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.simultaneous[e.id]&&(this.simultaneous[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(m(t)&&f(t,"recognizeWidth",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&delete this.simultaneous[e.id],this}requireFailure(t){if(m(t)&&f(t,"requireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);return e&&!this.requireFails.includes(e)&&(this.requireFails.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(m(t)&&f(t,"dropRequireFailure",this))return this;const e=this.getRecognizerByNameIfManager(t,this);if(e){const s=this.requireFails.indexOf(e);s>-1&&this.requireFails.splice(s,1)}return this}emit(t){(e=>{var s;(s=this._manager)==null||s.emit(e,t)})(this._type)}tryEmit(t){this.canEmit()&&this.emit(t),this._state=a.Failed}canEmit(){for(const t of this.requireFails)if(t._state!==a.Ended&&t._state!==a.Possible)return!1;return!0}recognize(t){const e={...t};this._options.enable||(this.reset(),this._state=a.Failed),this._state&(a.Ended|a.Canceled|a.Failed)&&(this._state=a.Possible),this._state=this.process(e),this._state&(a.Began|a.Changed|a.Ended|a.Canceled)&&this.tryEmit(e)}getRecognizerByNameIfManager(t,e){return e.manager?e.manager.get(t.type):t}}class I extends R{constructor(t){super(t)}attrTest(t){var e;const{pointers:s}=this.options;return s===0||((e=t.pointers)==null?void 0:e.length)===s}reset(){this.state=a.Possible}process(t){const{eventType:e}=t,s=this.state&(a.Began|a.Changed),n=this.attrTest(t);return s&&(e&r.Cancel||!n)?a.Canceled:s||n?e&r.End?a.Ended:this.state&a.Began?a.Changed:a.Began:a.Failed}}const B=class q extends R{constructor(t={}){super({...q.defaults,...t}),this._timer=null,this._isRecognized=!1,this._type=g.Press}getTouchAction(){return["auto"]}process(t){const e=t.pointers.length===this.options.pointers,s=t.distance<this.options.threshold,n=t.deltaTime>this.options.time;if(!s||!e||t.eventType&(r.End|r.Cancel)&&!n)this.reset();else if(t.eventType&r.Start)this.reset(),this._timer=setTimeout(()=>{this.state=a.Ended,this._isRecognized=!0,this.tryEmit(t)},this.options.time);else if(t.eventType&r.End)return a.Ended;return a.Failed}reset(){this._timer&&clearTimeout(this._timer),this._timer=null}emit(t){this._isRecognized&&(this._isRecognized=!1,t.deltaTime=Date.now()-t.timestamp,t.timestamp=Date.now(),super.emit(t))}};B.defaults={threshold:9,pointers:1,time:251};let W=B;const k=class j extends I{constructor(t={}){super({...j.defaults,...t}),this._type=g.Pan,this._dX=null,this._dY=null}getTouchAction(){const{direction:t}=this.options,e=[];return t&c.Horizontal&&e.push("pan-y"),t&c.Vertical&&e.push("pan-x"),e}attrTest(t){return!!(super.attrTest(t)&&(this.state&a.Began||!(this.state&a.Began)&&this._directionTest(t)))}emit(t){this._dX=t.deltaX||0,this._dY=t.deltaY||0;const e=b(t.direction);e&&(t.additionalEvent=`${this._type}-${e}`),super.emit(t)}_directionTest(t){let e=!0;const{deltaX:s,deltaY:n}=t;return t.direction&this.options.direction||(this.options.direction&c.Horizontal?(t.direction=s===0?c.None:s<0?c.Left:c.Right,t.distance=Math.abs(s),e=s!==this._dX):(t.direction=n===0?c.None:n<0?c.Up:c.Down,t.distance=Math.abs(n),e=n!==this._dY)),!!(e&&this.options.direction&t.direction&&t.distance>this.options.threshold)}};k.defaults={pointers:1,threshold:10,direction:c.All};let $=k;const G=class Z extends I{constructor(t={}){super({...Z.defaults,...t}),this._type=g.Swipe}getTouchAction(){const{direction:t}=this.options,e=[];return t&c.Horizontal&&e.push("pan-y"),t&c.Vertical&&e.push("pan-x"),e}attrTest(t){const{direction:e}=this.options;let s=0;return e&(c.Horizontal|c.Vertical)?s=t.overallVelocity:e&c.Horizontal?s=t.overallVelocityX:e&c.Vertical&&(s=t.overallVelocityY),!!(super.attrTest(t)&&e&t.offsetDirection&&t.eventType&r.End&&t.distance>this.options.threshold&&t.maxPointers===this.options.pointers&&Math.abs(s)>this.options.velocity)}emit(t){const e=b(t.offsetDirection);e&&(t.additionalEvent=`${this._type}-${e}`),super.emit(t)}};G.defaults={pointers:1,threshold:10,direction:c.All,velocity:.3};let K=G;const Pt=Object.freeze(Object.defineProperty({__proto__:null,AttrRecognizer:I,PanRecognizer:$,PressRecognizer:W,RECOGNIZER_STATE:a,RECOGNIZER_TYPE:g,Recognizer:R,SwipeRecognizer:K},Symbol.toStringTag,{value:"Module"}));var T=(i=>(i[i.Stop=1]="Stop",i[i.ForceStop=2]="ForceStop",i))(T||{});const ft={domEvents:!1,touchActions:["compute"],enable:!0,preventDefault:!1,stopPropagation:!1,stopImmediatePropagation:!1,inputTarget:null,cssProps:{userSelect:"none"}};class Tt{constructor(t,e){this.manager=t,this.actions=[...e],this.set(e)}set(t){t.includes("compute")&&(t=this._compute());const e=t.join(" ");this.manager.element.style.touchAction=e.toLowerCase().trim()}update(){this.manager.options.touchActions&&this.set([...this.manager.options.touchActions])}preventDefault(t){const{srcEvent:e}=t,s=t.offsetDirection;if(this.manager.session.prevented){e.preventDefault();return}const n=this.actions.includes("none"),o=this.actions.includes("pan-x"),h=this.actions.includes("pan-y");if(n){const l=t.pointers.length===1,p=t.distance<2,_=t.deltaTime<250;if(l&&p&&_)return}o&&h||(n||o&&s&F||h&&s&O)&&this._preventSrc(e)}_compute(){let t=[];return this.manager.recognizers.forEach(e=>{J(e.options.enable)&&e.options.enable&&(t=t.concat(e.getTouchAction()))}),this._cleanTouchActions(t)}_cleanTouchActions(t){if(t.includes("none"))return["none"];const e=t.includes("pan-x"),s=t.includes("pan-y");return e&&s?["none"]:e||s?e?["pan-x"]:["pan-y"]:t.includes("manipulation")?["manipulation"]:["auto"]}_preventSrc(t){this.manager.session.prevented=!0,t.preventDefault()}}class zt{constructor(t,e){this._element=t,this._options={...ft,...e},this._options.inputTarget=(e==null?void 0:e.inputTarget)??this._element,this._recognizers=[],this._input=U(this),this._session={},this.handlers={},this._touchAction=new Tt(this,this._options.touchActions),this._oldCssProps={},this._toggleCssProps("add")}get element(){return this._element}get options(){return this._options}get recognizers(){return this._recognizers}get session(){return this._session}get touchAction(){return this._touchAction}stop(t){this._session.stopped=t?T.ForceStop:T.Stop}get(t){return this._recognizers.find(e=>e.type===t)||null}set(t){return this._options={...this._options,...t},t.touchActions&&this._touchAction.update(),t.inputTarget&&(this._input.destroy(),this._input.target=t.inputTarget,this._input.init()),this}setOptions(t,e){const s=this.get(t);return s&&s.set(e),s}add(t){t.manager=this;const e=this._recognizers.findIndex(s=>s.type===t.type);return e>-1&&this._recognizers.splice(e,1),this._recognizers.push(t),this._touchAction.update(),this._recognizers}remove(t){const e=this._recognizers.findIndex(s=>s.type===t.type);return e>-1&&this._recognizers.splice(e,1),this._touchAction.update(),this._recognizers}on(t,e){this.get(t)||this._presetRecognizers(t),this.handlers[t]=e}off(t){t.forEach(e=>{delete this.handlers[e];const s=this.get(e);s&&this.remove(s)})}destroy(){this._toggleCssProps("remove"),this._recognizers=[],this._input.destroy(),this._session={},this.handlers={}}recognize(t){if(this._session.stopped)return;this.touchAction.preventDefault(t);let{curRecognizer:e}=this._session;(!e||e&&e.state&a.Ended)&&(e=this._session.curRecognizer=null);for(let s=0;s<this._recognizers.length;s++){const n=this._recognizers[s];this._session.stopped!==T.ForceStop&&(!e||n===e||n.canRecognizeWith(e))?n.recognize(t):n.reset(),!e&&n.state&(a.Began|a.Changed|a.Ended)&&(e=this._session.curRecognizer=n)}}emit(t,e){const s=this.handlers[t];e.type=t,e.preventDefault=()=>{var n;(n=e.srcEvent)==null||n.preventDefault()},s&&s(e)}clearSession(){this._session={}}_toggleCssProps(t){!this._options.cssProps||!this._element.style||(E(this._options.cssProps,(e,s)=>{t==="add"?(this._oldCssProps[s]=this._element.style[s],this._element.style[s]=e):this._element.style[s]=this._oldCssProps[s]||""}),t!=="add"&&(this._oldCssProps={}))}_presetRecognizers(t){switch(t){case g.Press:this.add(new W);break;case g.Pan:this.add(new $);break;case g.Swipe:this.add(new K);break}}}export{zt as M,Pt as v,Et as y};
