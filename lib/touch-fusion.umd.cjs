(function(f,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(f=typeof globalThis<"u"?globalThis:f||self,f.TouchFusion=a())})(this,function(){"use strict";var f=(s=>(s[s.Stop=1]="Stop",s[s.ForceStop=2]="ForceStop",s))(f||{}),a=(s=>(s[s.None=1]="None",s[s.Left=2]="Left",s[s.Right=4]="Right",s[s.Up=8]="Up",s[s.Down=16]="Down",s[s.Horizontal=6]="Horizontal",s[s.Vertical=24]="Vertical",s[s.All=30]="All",s))(a||{});const L=6,W=24;var r=(s=>(s[s.Start=1]="Start",s[s.Move=2]="Move",s[s.End=4]="End",s[s.Cancel=8]="Cancel",s))(r||{}),_=(s=>(s.Touch="touch",s.Mouse="mouse",s.Pen="pen",s.Kinect="kinect",s))(_||{});const X=25,V=/mobile|tablet|ip(ad|hone|od)|android/i,E="ontouchstart"in window||navigator.maxTouchPoints>0,q="PointerEvent"in window,B=E&&V.test(navigator.userAgent);var c=(s=>(s[s.Possible=1]="Possible",s[s.Began=2]="Began",s[s.Changed=4]="Changed",s[s.Ended=8]="Ended",s[s.Canceled=16]="Canceled",s[s.Failed=32]="Failed",s))(c||{}),y=(s=>(s.Secret="touch-fusion.input",s.Unknown="unknown",s.Swipe="swipe",s.Pan="pan",s.Pinch="pinch",s.Rotate="rotate",s.Press="press",s.Tap="tap",s))(y||{}),U=(s=>(s.COMPUTE="compute",s.AUTO="auto",s.MANIPULATION="manipulation",s.NONE="none",s.PAN_X="pan-x",s.PAN_Y="pan-y",s))(U||{});const G=["none","pan-x","pan-y","auto","manipulation","compute"],H={domEvents:!1,touchActions:["compute"],enable:!0,preventDefault:!1,stopPropagation:!1,stopImmediatePropagation:!1,inputTarget:null,cssProps:{userSelect:"none",touchAction:"none"}},Z=Object.freeze(Object.defineProperty({__proto__:null,ACTIONS:G,COMPUTE_INTERVAL:X,DEFAULT_OPTIONS:H,DIRECTION:a,DIRECTION_HORIZONTAL:L,DIRECTION_VERTICAL:W,INPUT_STATE:r,INPUT_TYPE:_,MOBILE_REGEX:V,RECOGNIZER_STATE:c,RECOGNIZER_TYPE:y,STOP_TYPE:f,SUPPORT_ONLY_TOUCH:B,SUPPORT_POINTER_EVENTS:q,SUPPORT_TOUCH:E,TOUCH_ACTION:U},Symbol.toStringTag,{value:"Module"})),D=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class S extends Error{constructor(e){super(e),this.name="TouchFusionError",Error.captureStackTrace&&Error.captureStackTrace(this,S)}}const ee=s=>{throw new S(s)},te=s=>{console.warn(`[TouchFusionWarning]: ${s}`)},Y=s=>typeof s=="boolean",se=s=>typeof s=="number",w=s=>typeof s=="string",j=s=>typeof s=="function",k=s=>s===null||Object.prototype.toString.call(s)==="[object Array]"?!1:typeof s=="object",m=s=>Array.isArray(s),ne=s=>s instanceof Element,ie=s=>s instanceof HTMLElement,oe=s=>s instanceof TouchEvent,re=s=>s instanceof MouseEvent,ce=s=>s instanceof PointerEvent,he=s=>s instanceof TouchList,le=s=>s!==void 0,ae=s=>s===void 0,ue=s=>s===null,de=s=>s==null,C=s=>`${s}-${Date.now()}-${Math.floor(Math.random()*1e5)}`,v=(s,e,t)=>{if(!(!k(s)&&!m(s)))if(m(s))s.forEach(e,t);else for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.call(t,s[n],n,s)},M=(s,e,t)=>!m(s)||!j(t[e])?!1:(v(s,t[e],t),!0),$=(s,e,t=!1)=>{const n=[],i=[];for(let o=0;o<s.length;o++){const h=e?s[o][e]:s[o];i.indexOf(h)===-1&&n.push(s[o]),i[o]=h}return t&&(e?n.sort((o,h)=>o[e]>h[e]?1:-1):n.sort()),n},T=(s,e,t)=>{v(e,n=>{w(n)&&s.addEventListener(n,t,!1)})},x=(s,e,t)=>{v(e,n=>{w(n)&&s.removeEventListener(n,t,!1)})},z=(s,e)=>{for(;s;){if(s===e)return!0;s=s.parentNode}return!1},I=(s,e)=>function(...n){return s.apply(e,n)},fe=Object.freeze(Object.defineProperty({__proto__:null,addEventListener:T,bindFn:I,each:v,generateId:C,hasParentNode:z,invokeArrayArg:M,isArray:m,isBoolean:Y,isDefined:le,isElement:ne,isFunction:j,isHTMLElement:ie,isMouseEvent:re,isNil:de,isNull:ue,isNumber:se,isObject:k,isPointerEvent:ce,isString:w,isTouchEvent:oe,isTouchList:he,isUndefined:ae,removeEventListener:x,throwError:ee,throwWarning:te,uniqueArray:$},Symbol.toStringTag,{value:"Module"}));let F=class{constructor(e){this._type=y.Unknown,this._options={...e},this._id=C(this.type),this._manager=null,this._options.enable=this._options.enable??!0,this._state=c.Possible,this.simultaneous={},this.requireFails=[]}get type(){return this._type}get id(){return this._id}get state(){return this._state}get options(){return this._options}get hasRequireFailures(){return this.requireFails.length>0}set state(e){this._state=e}set manager(e){this._manager=e}set(e){var t;this._options={...this._options,...e},(t=this._manager)==null||t.touchAction.update()}canRecognizeWith(e){return!!this.simultaneous[e.id]}recognizeWith(e){if(m(e)&&M(e,"recognizeWidth",this))return this;const t=this.getRecognizerByNameIfManager(e,this);return t&&!this.simultaneous[t.id]&&(this.simultaneous[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(m(e)&&M(e,"recognizeWidth",this))return this;const t=this.getRecognizerByNameIfManager(e,this);return t&&delete this.simultaneous[t.id],this}requireFailure(e){if(m(e)&&M(e,"requireFailure",this))return this;const t=this.getRecognizerByNameIfManager(e,this);return t&&!this.requireFails.includes(t)&&(this.requireFails.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(m(e)&&M(e,"dropRequireFailure",this))return this;const t=this.getRecognizerByNameIfManager(e,this);if(t){const n=this.requireFails.indexOf(t);n>-1&&this.requireFails.splice(n,1)}return this}emit(e){(n=>{var i;(i=this._manager)==null||i.emit(n,e)})(this._type)}tryEmit(e){this.canEmit()&&this.emit(e),this._state=c.Failed}canEmit(){for(const e of this.requireFails)if(e._state!==c.Ended&&e._state!==c.Possible)return!1;return!0}recognize(e){const t={...e};this._options.enable||(this.reset(),this._state=c.Failed),this._state&(c.Ended|c.Canceled|c.Failed)&&(this._state=c.Possible),this._state=this.process(t),this._state&(c.Began|c.Changed|c.Ended|c.Canceled)&&this.tryEmit(t)}getRecognizerByNameIfManager(e,t){return t.manager?t.manager.get(e.type):e}};class pe extends F{constructor(e){super(e)}attrTest(e){var n;const{pointers:t}=this.options;return t===0||((n=e.pointers)==null?void 0:n.length)===t}reset(){this.state=c.Possible}process(e){const{eventType:t}=e,n=this.state&(c.Began|c.Changed),i=this.attrTest(e);return n&&(t&r.Cancel||!i)?c.Canceled:n||i?t&r.End?c.Ended:this.state&c.Began?c.Changed:c.Began:c.Failed}}const b=class b extends F{constructor(e={}){super({...b.defaults,...e}),this._timer=null,this._isRecognized=!1,this._type=y.Press}getTouchAction(){return["auto"]}process(e){const t=e.pointers.length===this.options.pointers,n=e.distance<this.options.threshold,i=e.deltaTime>this.options.time;if(!n||!t||e.eventType&(r.End|r.Cancel)&&!i)this.reset();else if(e.eventType&r.Start)this.reset(),this._timer=setTimeout(()=>{this.state=c.Ended,this._isRecognized=!0,this.tryEmit(e)},this.options.time);else if(e.eventType&r.End)return c.Ended;return c.Failed}reset(){this._timer&&clearTimeout(this._timer),this._timer=null}emit(e){this._isRecognized&&(this._isRecognized=!1,e.deltaTime=Date.now()-e.timestamp,e.timestamp=Date.now(),super.emit(e))}};b.defaults={threshold:9,pointers:1,time:251};let A=b;const ge=Object.freeze(Object.defineProperty({__proto__:null,AttrRecognizer:pe,PressRecognizer:A,Recognizer:F},Symbol.toStringTag,{value:"Module"}));class me{constructor(e,t){this.manager=e,this.actions=[...t],this.set(t)}set(e){const t=e.join(" ");this.manager.element.style.touchAction=t.toLowerCase().trim()}update(){this.manager.options.touchActions&&this.set([...this.manager.options.touchActions])}compute(){let e=[];return this.manager.recognizers.forEach(t=>{Y(t.options.enable)&&t.options.enable&&(e=e.concat(t.getTouchAction()))}),this.cleanTouchActions(e)}preventDefault(e){const{srcEvent:t}=e,n=e.offsetDirection;if(this.manager.session.prevented){t.preventDefault();return}const i=this.actions.includes("none"),o=this.actions.includes("pan-x"),h=this.actions.includes("pan-y");if(i){const l=e.pointers.length===1,p=e.distance<2,u=e.deltaTime<250;if(l&&p&&u)return}if(!(o&&h)&&(i||o&&n===L||h&&n===W))return this.preventSrc(t)}cleanTouchActions(e){if(e.includes("none"))return"none";const t=e.includes("pan-x"),n=e.includes("pan-y");return t&&n?"none":t||n?t?"pan-x":"pan-y":e.includes("manipulation")?"manipulation":"auto"}preventSrc(e){this.manager.session.prevented=!0,e.preventDefault()}}class P{constructor(e,t){this._evEl=[],this._evWin=[],this._evTarget=[],this._manager=e,this.el=e.element,this._target=e.options.inputTarget,this.callback=t,this.domHandler=n=>{this._manager.options.enable&&this.handler(n)}}get manager(){return this._manager}get target(){return this._target}set evEl(e){this._evEl=e}set evWin(e){this._evWin=e}set evTarget(e){this._evTarget=e}init(){this._evEl.length!==0&&T(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&T(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&T(window,this._evWin,this.domHandler)}destroy(){this._evEl.length!==0&&x(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&x(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&x(window,this._evWin,this.domHandler)}}const _e={mousedown:r.Start,mousemove:r.Move,mouseup:r.End},ye=["mousedown"],ve=["mousemove","mouseup"];class K extends P{constructor(e,t){super(e,t),this.evEl=ye,this.evWin=ve,this._pressed=!1,this.init()}handler(e){const t=_e[e.type];t===r.Start&&e.button===0&&(this._pressed=!0),this._pressed&&(t===r.End&&(this._pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:_.Mouse,srcEvent:e}))}}const Me={touchstart:r.Start,touchmove:r.Move,touchend:r.End,touchcancel:r.Cancel},Te=["touchstart","touchmove","touchend","touchcancel"];class J extends P{constructor(e,t){super(e,t),this.evTarget=Te,this.targetIds={},this.init()}handler(e){const t=Me[e.type],n=this.getTouches(e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:_.Touch,srcEvent:e})}getTouches(e,t){const n=Array.from(e.touches);if(t&(r.Start|r.Move)&&n.length===1){const l=n[0];return this.targetIds[l.identifier]=!0,[n,n]}const i=n.filter(l=>z(l.target,this.target));if(t===r.Start)for(let l=0;l<i.length;l++)this.targetIds[i[l].identifier]=!0;const o=Array.from(e.changedTouches),h=[];for(let l=0;l<i.length;l++)this.targetIds[i[l].identifier]&&h.push(o[l]),(t===r.End||t===r.Cancel)&&delete this.targetIds[o[l].identifier];return h.length?[$(i.concat(h),"identifier",!0),h]:null}}const xe={pointerdown:r.Start,pointermove:r.Move,pointerup:r.End,pointercancel:r.Cancel,pointerout:r.Cancel},Pe=["pointerdown"],be=["pointermove","pointerup","pointercancel","pointerout"];class Ee extends P{constructor(e,t){super(e,t),this.evEl=Pe,this.evWin=be,this._store=[],this.init()}handler(e){const t=xe[e.type],n=e.pointerType===_.Touch;let i=this._store.findIndex(h=>h.pointerId===e.pointerId),o=!1;t===r.Start&&(e.button===0||n)?i===-1&&(this._store.push(e),i=this._store.length-1):(t===r.End||t===r.Cancel)&&(o=!0),i!==-1&&(this._store[i]=e,this.callback(this.manager,t,{pointers:this._store,changedPointers:[e],pointerType:e.pointerType,srcEvent:e}),o&&this._store.splice(i,1))}}const Se=2500,O=25;class we extends P{constructor(e,t){super(e,t);const n=I(this.handler,this);this._mouse=new K(e,n),this._touch=new J(e,n),this._primaryTouch=null,this._lastTouches=[]}handler(e,t,n){const i=n.pointerType===_.Touch,o=n.pointerType===_.Mouse;if(i)this._recordTouches(t,n);else if(o&&this._isSyntheticEvent(n))return}destroy(){this._mouse.destroy(),this._touch.destroy()}_recordTouches(e,t){e===r.Start?(this._primaryTouch=t.changedPointers[0].identifier,this._setLastTouch(t)):(e===r.End||e===r.Cancel)&&this._setLastTouch(t)}_setLastTouch(e){const t=e.changedPointers[0];if(t.identifier===this._primaryTouch){const n={x:t.clientX,y:t.clientY};this._lastTouches.push(n);const i=setTimeout(()=>{const o=this._lastTouches.indexOf(n);o>-1&&this._lastTouches.splice(o,1),clearTimeout(i)},Se)}}_isSyntheticEvent(e){const t=e.srcEvent,n=t.clientX,i=t.clientY;for(let o=0;o<this._lastTouches.length;o++){const h=this._lastTouches[o],l=Math.abs(n-h.x),p=Math.abs(i-h.y);if(l<=O&&p<=O)return!0}return!1}}class d{static getAngle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI}static getDistance(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}static getDirection(e,t){return e===t?a.None:Math.abs(e)>=Math.abs(t)?e<0?a.Left:a.Right:t<0?a.Up:a.Down}static getCenter(e){const t=Math.round(e.reduce((i,o)=>i+o.x,0)/e.length),n=Math.round(e.reduce((i,o)=>i+o.y,0)/e.length);return{x:t,y:n}}static getRotation(e,t){return this.getAngle(t[1],t[0])+this.getAngle(e[1],e[0])}static getScale(e,t){return this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1])}static getVelocity(e,t,n){return{x:t/e||0,y:n/e||0}}}const ze=(s,e,t)=>{const n=t.pointers.length,i=t.changedPointers.length,o=e&r.Start&&n-i===0,h=e&(r.End|r.Cancel)&&n-i===0;t.isFirst=!!o,t.isFinal=!!h,o&&s.clearSession(),t.eventType=e,Fe(s,t),s.options.preventDefault&&t.srcEvent.preventDefault(),s.options.stopPropagation&&t.srcEvent.stopPropagation(),s.options.stopImmediatePropagation&&t.srcEvent.stopImmediatePropagation(),s.emit(y.Secret,t),s.recognize(t),s.session.prevInput=t},Fe=(s,e)=>{var N;const t=s.session,n=e.pointers.length;t.firstInput||(t.firstInput=Q(e)),n>1&&!t.firstMultiple?t.firstMultiple=Q(e):n===1&&(t.firstMultiple=null);const{firstInput:i,firstMultiple:o}=t,h=o?o.center:i.center,l=[];(N=e.pointers)==null||N.forEach(R=>{l.push({x:Math.round(R.clientX),y:Math.round(R.clientY)})});const p=e.center=d.getCenter(l);e.timestamp=Date.now(),e.deltaTime=e.timestamp-i.timestamp,e.angle=d.getAngle(h,p),e.distance=d.getDistance(h,p),Ae(t,e),e.offsetDirection=d.getDirection(e.deltaX,e.deltaY);const u=d.getVelocity(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=u.x,e.overallVelocityY=u.y,e.overallVelocity=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,e.scale=o?d.getScale(o.pointers,l):1,e.rotation=o?d.getRotation(o.pointers,l):0,e.maxPointers=t.prevInput?Math.max(e.pointers.length,t.prevInput.maxPointers):e.pointers.length;const g=s.element;z(e.srcEvent.target,g)?e.target=e.srcEvent.target:e.target=g,Le(t,e)},Q=s=>{const e=[];for(let t=0;t<s.pointers.length;t++)e.push({x:Math.round(s.pointers[t].clientX),y:Math.round(s.pointers[t].clientY)});return{pointers:e,timestamp:Date.now(),center:d.getCenter(e),deltaX:s.deltaX||0,deltaY:s.deltaY||0}},Ae=(s,e)=>{const t=e.center;let n=s.offsetDelta||{x:0,y:0},i=s.prevDelta||{x:0,y:0};const o=s.prevInput||{center:t};(e.eventType===r.Start||e.eventType===r.End)&&(i=s.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=s.offsetDelta={x:t.x,y:t.y}),e.deltaX=i.x+(t.x-n.x),e.deltaY=i.y+(t.y-n.y)},Le=(s,e)=>{const t=s.lastInterval||e,n=e.timestamp-t.timestamp;let i,o,h,l;if(e.eventType!==r.Cancel&&(n>X||t.velocity===void 0)){const p=e.deltaX-t.deltaX,u=e.deltaY-t.deltaY,g=d.getVelocity(n,p,u);o=g.x,h=g.y,i=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,l=d.getDirection(p,u),s.lastInterval=e}else o=t.velocityX,h=t.velocityY,i=t.overallVelocity,l=t.direction;e.velocityX=o,e.velocityY=h,e.velocity=i,e.direction=l},We=s=>{let e;return q?e=Ee:B?e=J:E?e=we:e=K,new e(s,ze)};class Xe{constructor(e,t){this._element=e,this._options={...H,...t},this._options.inputTarget=(t==null?void 0:t.inputTarget)??this._element,this._recognizers=[],this._input=We(this),this._touchAction=new me(this,this._options.touchActions),this._session={},this.handlers={},this._oldCssProps={},this._toggleCssProps("add")}get element(){return this._element}get options(){return this._options}get recognizers(){return this._recognizers}get session(){return this._session}get touchAction(){return this._touchAction}stop(e){this._session.stopped=e?f.ForceStop:f.Stop}set(e){this._options={...this._options,...e}}get(e){return this._recognizers.find(t=>t.type===e)||null}add(e){e.manager=this,this._recognizers.push(e)}remove(e){const t=this._recognizers.findIndex(n=>n.type===e.type);t>-1&&this._recognizers.splice(t,1)}on(e,t){this.handlers[e]=t}off(e){e.forEach(t=>{delete this.handlers[t]})}destroy(){this._toggleCssProps("remove"),this._recognizers=[],this._input.destroy(),this._session={},this.handlers={}}recognize(e){if(this._session.stopped)return;this.touchAction.preventDefault(e);let{curRecognizer:t}=this._session;(!t||t&&t.state===c.Ended)&&(t=this._session.curRecognizer=null);for(let n=0;n<this._recognizers.length;n++){const i=this._recognizers[n];this._session.stopped!==f.ForceStop&&(!t||i===t||i.canRecognizeWith(t))?i.recognize(e):i.reset(),!t&&i.state&(c.Began|c.Changed|c.Ended)&&(t=this._session.curRecognizer=i)}}emit(e,t){const n=this.handlers[e];t.type=e,t.preventDefault=()=>{var i;(i=t.srcEvent)==null||i.preventDefault()},n&&n(t)}clearSession(){this._session={}}_toggleCssProps(e){!this._options.cssProps||!this._element.style||(v(this._options.cssProps,(t,n)=>{e==="add"?(this._oldCssProps[n]=this._element.style[n],this._element.style[n]=t):this._element.style[n]=this._oldCssProps[n]||""}),e!=="add"&&(this._oldCssProps={}))}}return{Manager:Xe,Constants:Z,Types:D,Utils:fe,Recognizer:ge}});
