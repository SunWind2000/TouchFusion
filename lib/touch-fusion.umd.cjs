(function(g,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(g=typeof globalThis<"u"?globalThis:g||self,g.TouchFusion=a())})(this,function(){"use strict";var g=(s=>(s[s.Stop=1]="Stop",s[s.ForceStop=2]="ForceStop",s))(g||{}),a=(s=>(s[s.None=1]="None",s[s.Left=2]="Left",s[s.Right=4]="Right",s[s.Up=8]="Up",s[s.Down=16]="Down",s[s.Horizontal=6]="Horizontal",s[s.Vertical=24]="Vertical",s[s.All=30]="All",s))(a||{});const X=6,E=24;var r=(s=>(s[s.Start=1]="Start",s[s.Move=2]="Move",s[s.End=4]="End",s[s.Cancel=8]="Cancel",s))(r||{}),_=(s=>(s.Touch="touch",s.Mouse="mouse",s.Pen="pen",s.Kinect="kinect",s))(_||{});const W=25,V=/mobile|tablet|ip(ad|hone|od)|android/i,S="ontouchstart"in window||navigator.maxTouchPoints>0,G="PointerEvent"in window,q=S&&V.test(navigator.userAgent);var c=(s=>(s[s.Possible=1]="Possible",s[s.Began=2]="Began",s[s.Changed=4]="Changed",s[s.Ended=8]="Ended",s[s.Canceled=16]="Canceled",s[s.Failed=32]="Failed",s))(c||{}),y=(s=>(s.Secret="touch-fusion.input",s.Unknown="unknown",s.Swipe="swipe",s.Pan="pan",s.Pinch="pinch",s.Rotate="rotate",s.Press="press",s.Tap="tap",s))(y||{}),j=(s=>(s.COMPUTE="compute",s.AUTO="auto",s.MANIPULATION="manipulation",s.NONE="none",s.PAN_X="pan-x",s.PAN_Y="pan-y",s))(j||{});const Z=["none","pan-x","pan-y","auto","manipulation","compute"],B={domEvents:!1,touchActions:["compute"],enable:!0,inputTarget:null,cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0, 0, 0, 0)"}},D=Object.freeze(Object.defineProperty({__proto__:null,ACTIONS:Z,COMPUTE_INTERVAL:W,DEFAULT_OPTIONS:B,DIRECTION:a,DIRECTION_HORIZONTAL:X,DIRECTION_VERTICAL:E,INPUT_STATE:r,INPUT_TYPE:_,MOBILE_REGEX:V,RECOGNIZER_STATE:c,RECOGNIZER_TYPE:y,STOP_TYPE:g,SUPPORT_ONLY_TOUCH:q,SUPPORT_POINTER_EVENTS:G,SUPPORT_TOUCH:S,TOUCH_ACTION:j},Symbol.toStringTag,{value:"Module"})),ee=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class z extends Error{constructor(e){super(e),this.name="TouchFusionError",Error.captureStackTrace&&Error.captureStackTrace(this,z)}}const te=s=>{throw new z(s)},se=s=>{console.warn(`[TouchFusionWarning]: ${s}`)},H=s=>typeof s=="boolean",ne=s=>typeof s=="number",w=s=>typeof s=="string",U=s=>typeof s=="function",Y=s=>s===null||Object.prototype.toString.call(s)==="[object Array]"?!1:typeof s=="object",m=s=>Array.isArray(s),ie=s=>s instanceof Element,oe=s=>s instanceof HTMLElement,re=s=>s instanceof TouchEvent,ce=s=>s instanceof MouseEvent,he=s=>s instanceof PointerEvent,le=s=>s instanceof TouchList,ae=s=>s!==void 0,ue=s=>s===void 0,de=s=>s===null,ge=s=>s==null,k=s=>`${s}-${Date.now()}-${Math.floor(Math.random()*1e5)}`,M=(s,e,t)=>{if(!(!Y(s)&&!m(s)))if(m(s))s.forEach(e,t);else for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.call(t,s[n],n,s)},v=(s,e,t)=>!m(s)||!U(t[e])?!1:(M(s,t[e],t),!0),$=(s,e,t=!1)=>{const n=[],i=[];for(let o=0;o<s.length;o++){const l=e?s[o][e]:s[o];i.indexOf(l)===-1&&n.push(s[o]),i[o]=l}return t&&(e?n.sort((o,l)=>o[e]>l[e]?1:-1):n.sort()),n},b=(s,e,t)=>{M(e,n=>{w(n)&&s.addEventListener(n,t,!1)})},x=(s,e,t)=>{M(e,n=>{w(n)&&s.removeEventListener(n,t,!1)})},F=(s,e)=>{for(;s;){if(s===e)return!0;s=s.parentNode}return!1},fe=Object.freeze(Object.defineProperty({__proto__:null,addEventListener:b,each:M,generateId:k,hasParentNode:F,invokeArrayArg:v,isArray:m,isBoolean:H,isDefined:ae,isElement:ie,isFunction:U,isHTMLElement:oe,isMouseEvent:ce,isNil:ge,isNull:de,isNumber:ne,isObject:Y,isPointerEvent:he,isString:w,isTouchEvent:re,isTouchList:le,isUndefined:ue,removeEventListener:x,throwError:te,throwWarning:se,uniqueArray:$},Symbol.toStringTag,{value:"Module"}));class P{constructor(e,t){this._evEl=[],this._evWin=[],this._evTarget=[],this._manager=e,this.el=e.element,this._target=e.options.inputTarget,this.callback=t,this.domHandler=n=>{this._manager.options.enable&&this.handler(n)}}get manager(){return this._manager}get target(){return this._target}set evEl(e){this._evEl=e}set evWin(e){this._evWin=e}set evTarget(e){this._evTarget=e}init(){this._evEl.length!==0&&b(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&b(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&b(window,this._evWin,this.domHandler)}destroy(){this._evEl.length!==0&&x(this.el,this._evEl,this.domHandler),this._evTarget.length!==0&&this.target&&x(this.target,this._evTarget,this.domHandler),this._evWin.length!==0&&x(window,this._evWin,this.domHandler)}}const pe={mousedown:r.Start,mousemove:r.Move,mouseup:r.End},me=["mousedown"],_e=["mousemove","mouseup"];class O extends P{constructor(e,t){super(e,t),this.evEl=me,this.evWin=_e,this._pressed=!1,this.init()}handler(e){const t=pe[e.type];t===r.Start&&e.button===0&&(this._pressed=!0),this._pressed&&(t===r.End&&(this._pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:_.Mouse,srcEvent:e}))}}const ye={touchstart:r.Start,touchmove:r.Move,touchend:r.End,touchcancel:r.Cancel},ve=["touchstart","touchmove","touchend","touchcancel"];class K extends P{constructor(e,t){super(e,t),this.evTarget=ve,this.targetIds={},this.init()}handler(e){const t=ye[e.type],n=this.getTouches(e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:_.Touch,srcEvent:e})}getTouches(e,t){const n=Array.from(e.touches);if(t&(r.Start|r.Move)&&n.length===1){const h=n[0];return this.targetIds[h.identifier]=!0,[n,n]}const i=n.filter(h=>F(h.target,this.target));if(t===r.Start)for(let h=0;h<i.length;h++)this.targetIds[i[h].identifier]=!0;const o=Array.from(e.changedTouches),l=[];for(let h=0;h<i.length;h++)this.targetIds[i[h].identifier]&&l.push(o[h]),(t===r.End||t===r.Cancel)&&delete this.targetIds[o[h].identifier];return l.length?[$(i.concat(l),"identifier",!0),l]:null}}const Me=2500,C=25;class be extends P{constructor(e,t){super(e,t),this._mouse=new O(e,this.handler),this._touch=new K(e,this.handler),this._primaryTouch=null,this._lastTouches=[]}handler(e,t,n){const i=n.pointerType===_.Touch,o=n.pointerType===_.Mouse;if(i)this._recordTouches(t,n);else if(o&&this._isSyntheticEvent(n))return}destroy(){this._mouse.destroy(),this._touch.destroy()}_recordTouches(e,t){e===r.Start?(this._primaryTouch=t.changedPointers[0].identifier,this._setLastTouch(t)):(e===r.End||e===r.Cancel)&&this._setLastTouch(t)}_setLastTouch(e){const t=e.changedPointers[0];if(t.identifier===this._primaryTouch){const n={x:t.clientX,y:t.clientY};this._lastTouches.push(n);const i=setTimeout(()=>{const o=this._lastTouches.indexOf(n);o>-1&&this._lastTouches.splice(o,1),clearTimeout(i)},Me)}}_isSyntheticEvent(e){const t=e.srcEvent,n=t.clientX,i=t.clientY;for(let o=0;o<this._lastTouches.length;o++){const l=this._lastTouches[o],h=Math.abs(n-l.x),f=Math.abs(i-l.y);if(h<=C&&f<=C)return!0}return!1}}class u{static getAngle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI}static getDistance(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}static getDirection(e,t){return e===t?a.None:Math.abs(e)>=Math.abs(t)?e<0?a.Left:a.Right:t<0?a.Up:a.Down}static getCenter(e){const t=Math.round(e.reduce((i,o)=>i+o.x,0)/e.length),n=Math.round(e.reduce((i,o)=>i+o.y,0)/e.length);return{x:t,y:n}}static getRotation(e,t){return this.getAngle(t[1],t[0])+this.getAngle(e[1],e[0])}static getScale(e,t){return this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1])}static getVelocity(e,t,n){return{x:t/e||0,y:n/e||0}}}const xe=(s,e,t)=>{const n=t.pointers.length,i=t.changedPointers.length,o=e&r.Start&&n-i===0,l=e&(r.End|r.Cancel)&&n-i===0;t.isFirst=!!o,t.isFinal=!!l,o&&s.clearSession(),t.eventType=e,Te(s,t),s.emit(y.Secret,t),s.recognize(t),s.session.prevInput=t},Te=(s,e)=>{var N;const t=s.session,n=e.pointers.length;t.firstInput||(t.firstInput=J(e)),n>1&&!t.firstMultiple?t.firstMultiple=J(e):n===1&&(t.firstMultiple=null);const{firstInput:i,firstMultiple:o}=t,l=o?o.center:i.center,h=[];(N=e.pointers)==null||N.forEach(R=>{h.push({x:Math.round(R.clientX),y:Math.round(R.clientY)})});const f=e.center=u.getCenter(h);e.timestamp=Date.now(),e.deltaTime=e.timestamp-i.timestamp,e.angle=u.getAngle(l,f),e.distance=u.getDistance(l,f),Se(t,e),e.offsetDirection=u.getDirection(e.deltaX,e.deltaY);const d=u.getVelocity(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=d.x,e.overallVelocityY=d.y,e.overallVelocity=Math.abs(d.x)>Math.abs(d.y)?d.x:d.y,e.scale=o?u.getScale(o.pointers,h):1,e.rotation=o?u.getRotation(o.pointers,h):0,e.maxPointers=t.prevInput?Math.max(e.pointers.length,t.prevInput.maxPointers):e.pointers.length;const p=s.element;F(e.srcEvent.target,p)?e.target=e.srcEvent.target:e.target=p,ze(t,e)},J=s=>{const e=[];for(let t=0;t<s.pointers.length;t++)e.push({x:Math.round(s.pointers[t].clientX),y:Math.round(s.pointers[t].clientY)});return{pointers:e,timestamp:Date.now(),center:u.getCenter(e),deltaX:s.deltaX||0,deltaY:s.deltaY||0}},Se=(s,e)=>{const t=e.center;let n=s.offsetDelta||{x:0,y:0},i=s.prevDelta||{x:0,y:0};const o=s.prevInput||{center:t};(e.eventType===r.Start||e.eventType===r.End)&&(i=s.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=s.offsetDelta={x:t.x,y:t.y}),e.deltaX=i.x+(t.x-n.x),e.deltaY=i.y+(t.y-n.y)},ze=(s,e)=>{const t=s.lastInterval||e,n=e.timestamp-t.timestamp;let i,o,l,h;if(e.eventType!==r.Cancel&&(n>W||t.velocity===void 0)){const f=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=u.getVelocity(n,f,d);o=p.x,l=p.y,i=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,h=u.getDirection(f,d),s.lastInterval=e}else o=t.velocityX,l=t.velocityY,i=t.overallVelocity,h=t.direction;e.velocityX=o,e.velocityY=l,e.velocity=i,e.direction=h},Q=s=>{let e;return q?e=K:S?e=be:e=O,new e(s,xe)},we=Object.freeze(Object.defineProperty({__proto__:null,InputUtil:u,createInputInstance:Q},Symbol.toStringTag,{value:"Module"}));class A{constructor(e){this._type=y.Unknown,this._options={...e},this._id=k(this.type),this._manager=null,this._options.enable=this._options.enable??!0,this._state=c.Possible,this.simultaneous={},this.requireFails=[]}get type(){return this._type}get id(){return this._id}get state(){return this._state}get options(){return this._options}get hasRequireFailures(){return this.requireFails.length>0}set state(e){this._state=e}set manager(e){this._manager=e}set(e){var t;this._options={...this._options,...e},(t=this._manager)==null||t.touchAction.update()}canRecognizeWith(e){return!!this.simultaneous[e.id]}recognizeWith(e){if(m(e)&&v(e,"recognizeWidth",this))return this;const t=this.getRecognizerByNameIfManager(e,this);return t&&!this.simultaneous[t.id]&&(this.simultaneous[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(m(e)&&v(e,"recognizeWidth",this))return this;const t=this.getRecognizerByNameIfManager(e,this);return t&&delete this.simultaneous[t.id],this}requireFailure(e){if(m(e)&&v(e,"requireFailure",this))return this;const t=this.getRecognizerByNameIfManager(e,this);return t&&!this.requireFails.includes(t)&&(this.requireFails.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(m(e)&&v(e,"dropRequireFailure",this))return this;const t=this.getRecognizerByNameIfManager(e,this);if(t){const n=this.requireFails.indexOf(t);n>-1&&this.requireFails.splice(n,1)}return this}emit(e){(n=>{var i;(i=this._manager)==null||i.emit(n,e)})(this._type)}tryEmit(e){this.canEmit()&&this.emit(e),this._state=c.Failed}canEmit(){for(const e of this.requireFails)if(e._state!==c.Ended&&e._state!==c.Possible)return!1;return!0}recognize(e){const t={...e};this._options.enable||(this.reset(),this._state=c.Failed),this._state&(c.Ended|c.Canceled|c.Failed)&&(this._state=c.Possible),this._state=this.process(t),this._state&(c.Began|c.Changed|c.Ended|c.Canceled)&&this.tryEmit(t)}getRecognizerByNameIfManager(e,t){return t.manager?t.manager.get(e.type):e}}class Fe extends A{constructor(e){super(e)}attrTest(e){var n;const{pointers:t}=this.options;return t===0||((n=e.pointers)==null?void 0:n.length)===t}reset(){this.state=c.Possible}process(e){const{eventType:t}=e,n=this.state&(c.Began|c.Changed),i=this.attrTest(e);return n&&(t&r.Cancel||!i)?c.Canceled:n||i?t&r.End?c.Ended:this.state&c.Began?c.Changed:c.Began:c.Failed}}const T=class T extends A{constructor(e={}){super({...T.defaults,...e}),this._timer=null,this._isRecognized=!1,this._type=y.Press}getTouchAction(){return["auto"]}process(e){const t=e.pointers.length===this.options.pointers,n=e.distance<this.options.threshold,i=e.deltaTime>this.options.time;if(!n||!t||e.eventType&(r.End|r.Cancel)&&!i)this.reset();else if(e.eventType&r.Start)this.reset(),this._timer=setTimeout(()=>{this.state=c.Ended,this._isRecognized=!0,this.tryEmit(e)},this.options.time);else if(e.eventType&r.End)return c.Ended;return c.Failed}reset(){this._timer&&clearTimeout(this._timer),this._timer=null}emit(e){this._isRecognized&&(this._isRecognized=!1,super.emit(e))}};T.defaults={threshold:9,pointers:1,time:251};let L=T;const Pe=Object.freeze(Object.defineProperty({__proto__:null,AttrRecognizer:Fe,PressRecognizer:L,Recognizer:A},Symbol.toStringTag,{value:"Module"}));class I{constructor(e,t){this.manager=e,this.actions=[...t],this.set(t)}set(e){const t=e.join(" ");this.manager.element.style.touchAction=t.toLowerCase().trim()}update(){this.manager.options.touchActions&&this.set([...this.manager.options.touchActions])}compute(){let e=[];return this.manager.recognizers.forEach(t=>{H(t.options.enable)&&t.options.enable&&(e=e.concat(t.getTouchAction()))}),this.cleanTouchActions(e)}preventDefault(e){const{srcEvent:t}=e,n=e.offsetDirection;if(this.manager.session.prevented){t.preventDefault();return}const i=this.actions.includes("none"),o=this.actions.includes("pan-x"),l=this.actions.includes("pan-y");if(i){const h=e.pointers.length===1,f=e.distance<2,d=e.deltaTime<250;if(h&&f&&d)return}if(!(o&&l)&&(i||o&&n===X||l&&n===E))return this.preventSrc(t)}cleanTouchActions(e){if(e.includes("none"))return"none";const t=e.includes("pan-x"),n=e.includes("pan-y");return t&&n?"none":t||n?t?"pan-x":"pan-y":e.includes("manipulation")?"manipulation":"auto"}preventSrc(e){this.manager.session.prevented=!0,e.preventDefault()}}const Ae=Object.freeze(Object.defineProperty({__proto__:null,TouchAction:I},Symbol.toStringTag,{value:"Module"}));class Le{constructor(e,t){this._element=e,this._options={...B,...t},this._options.inputTarget=(t==null?void 0:t.inputTarget)??this._element,this._recognizers=[],this._input=Q(this),this._touchAction=new I(this,this._options.touchActions),this._session={},this.handlers={}}get element(){return this._element}get options(){return this._options}get recognizers(){return this._recognizers}get session(){return this._session}get touchAction(){return this._touchAction}stop(e){this._session.stopped=e?g.ForceStop:g.Stop}set(e){this._options={...this._options,...e}}get(e){return this._recognizers.find(t=>t.type===e)||null}add(e){e.manager=this,this._recognizers.push(e)}remove(e){const t=this._recognizers.findIndex(n=>n.type===e.type);t>-1&&this._recognizers.splice(t,1)}on(e,t){e.forEach(n=>{this.handlers[n]=t})}off(e){e.forEach(t=>{delete this.handlers[t]})}destroy(){this._recognizers=[],this._input.destroy(),this._session={},this.handlers={}}recognize(e){if(this._session.stopped)return;this.touchAction.preventDefault(e);let{curRecognizer:t}=this._session;(!t||t&&t.state===c.Ended)&&(t=this._session.curRecognizer=null);for(let n=0;n<this._recognizers.length;n++){const i=this._recognizers[n];this._session.stopped!==g.ForceStop&&(!t||i===t||i.canRecognizeWith(t))?i.recognize(e):i.reset(),!t&&i.state&(c.Began|c.Changed|c.Ended)&&(t=this._session.curRecognizer=i)}}emit(e,t){const n=this.handlers[e];t.type=e,t.preventDefault=()=>{var i;(i=t.srcEvent)==null||i.preventDefault()},n&&n(t)}clearSession(){this._session={}}}return{Constants:D,Types:ee,Utils:fe,Core:Object.freeze(Object.defineProperty({__proto__:null,Input:we,Manager:Le,Recognizer:Pe,TouchAction:Ae},Symbol.toStringTag,{value:"Module"}))}});
